import { useState, useMemo, useCallback } from "react";

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EMBEDDED CSV BACKEND â€“ single source of truth
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RAW_CSV = `MemberID,Name,Age,SHGName,Role,Attendance,Savings,LoanStatus,LoanAmount,EMIStatus,JoinDate
SHG001,Sita Devi,34,Shakti Mahila SHG,President,96,18500,Active,50000,On Time,2023-01-15
SHG002,Rani Kumari,29,Shakti Mahila SHG,Treasurer,90,15200,Active,30000,On Time,2023-02-10
SHG003,Lakshmi Bai,41,Shakti Mahila SHG,Secretary,92,22300,None,0,N/A,2022-11-20
SHG004,Meena Devi,35,Shakti Mahila SHG,Member,85,12800,Closed,20000,Completed,2023-04-05
SHG005,Sunita Yadav,27,Ujjwala SHG,President,94,19400,Active,40000,On Time,2022-08-18
SHG006,Anjali Patel,32,Ujjwala SHG,Treasurer,88,14700,None,0,N/A,2023-03-11
SHG007,Kavita Singh,38,Ujjwala SHG,Secretary,91,21000,Active,60000,Delayed,2022-06-09
SHG008,Pooja Sharma,30,Ujjwala SHG,Member,82,10500,Closed,25000,Completed,2023-01-22
SHG009,Rekha Devi,45,Pragati SHG,President,98,30500,Active,100000,On Time,2020-07-19
SHG010,Nirmala Joshi,35,Pragati SHG,Treasurer,92,18900,None,0,N/A,2023-02-11
SHG011,Asha Kumari,28,Pragati SHG,Secretary,87,13600,Active,20000,On Time,2023-05-03
SHG012,Radha Mishra,40,Pragati SHG,Member,84,11200,Closed,35000,Completed,2022-09-01
SHG013,Savita Rao,37,Saraswati SHG,President,95,26700,Active,80000,On Time,2021-10-14
SHG014,Geeta Nair,33,Saraswati SHG,Treasurer,89,17500,None,0,N/A,2023-03-29
SHG015,Latha Iyer,42,Saraswati SHG,Secretary,93,24300,Active,50000,Delayed,2022-05-17
SHG016,Rukmini Das,31,Saraswati SHG,Member,86,12900,Closed,30000,Completed,2023-01-08
SHG017,Kamala Reddy,39,Nirmala SHG,President,97,28800,Active,90000,On Time,2021-12-02
SHG018,Bhavya Jain,26,Nirmala SHG,Treasurer,85,11400,None,0,N/A,2023-06-21
SHG019,Shobha Patil,44,Nirmala SHG,Secretary,90,20600,Active,45000,On Time,2022-07-30
SHG020,Neha Kulkarni,34,Nirmala SHG,Member,83,13200,Closed,25000,Completed,2023-02-14`;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CSV PARSER  (mirrors original csvLoader.js)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseCSV(text) {
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",").map((h) => h.trim());
  const numericCols = new Set(["Age", "Attendance", "Savings", "LoanAmount"]);
  return lines.slice(1).map((line) => {
    const vals = line.split(",").map((v) => v.trim());
    const row = {};
    headers.forEach((h, i) => {
      row[h] = numericCols.has(h) ? parseFloat(vals[i]) || 0 : vals[i];
    });
    return row;
  });
}

const ALL_MEMBERS = parseCSV(RAW_CSV);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATIC DATA â€“ NGOs, Training, Pending Loans
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NGOS = [
  { id:1, name:"Udaya Mahila Sangha",  city:"Udupi",      state:"Karnataka", dist:2.4,  phone:"+91 82 0000 1234", email:"udaya@mahilasangha.org",  focus:"Women Empowerment", addr:"12, MG Road, Udupi" },
  { id:2, name:"Grameen Seva Trust",   city:"Mangalore",  state:"Karnataka", dist:11.8, phone:"+91 82 0000 5678", email:"info@grameenseva.org",    focus:"Rural Livelihood",  addr:"45, Nehru Street, Mangalore" },
  { id:3, name:"Shakti Foundation",    city:"Bangalore",  state:"Karnataka", dist:184.2,phone:"+91 80 1234 5678", email:"connect@shakti.in",       focus:"Micro Credit",      addr:"101, Brigade Road, Bangalore" },
  { id:4, name:"Kisan Seva Kendra",    city:"Hassan",     state:"Karnataka", dist:132.7,phone:"+91 82 3456 7890", email:"kisan@kisanseva.org",     focus:"Agri Finance",      addr:"8, Station Road, Hassan" },
  { id:5, name:"Jan Vikash NGO",       city:"Shimoga",    state:"Karnataka", dist:98.5, phone:"+91 83 4567 8901", email:"admin@janvikash.org",     focus:"Skill Development", addr:"22, Railway Line, Shimoga" },
  { id:6, name:"Sarvadaya Trust",      city:"Mysore",     state:"Karnataka", dist:161.0,phone:"+91 82 9876 5432", email:"trust@sarvadaya.org",     focus:"Education & Finance",addr:"7, Dasara Square, Mysore" },
];

const TRAINING_CATALOG = [
  { id:1, title:"Financial Literacy Basics",   totalLessons:5 },
  { id:2, title:"Group Management",            totalLessons:4 },
  { id:3, title:"Loan Application Process",    totalLessons:3 },
  { id:4, title:"Business Planning",           totalLessons:6 },
];
const TRAINING_PROGRESS = {
  "Sita Devi":       [5,3,1,0],
  "Rani Kumari":     [5,4,3,2],
  "Lakshmi Bai":     [4,0,0,0],
  "Meena Devi":      [5,2,0,0],
  "Sunita Yadav":    [5,4,2,0],
  "Anjali Patel":    [3,0,0,0],
  "Kavita Singh":    [5,4,3,1],
  "Pooja Sharma":    [5,3,1,0],
  "Rekha Devi":      [5,4,3,3],
  "Nirmala Joshi":   [5,2,0,0],
  "Asha Kumari":     [4,1,0,0],
  "Radha Mishra":    [5,4,2,0],
  "Savita Rao":      [5,4,3,2],
  "Geeta Nair":      [5,3,0,0],
  "Latha Iyer":      [5,4,3,1],
  "Rukmini Das":     [5,2,0,0],
  "Kamala Reddy":    [5,4,3,2],
  "Bhavya Jain":     [3,0,0,0],
  "Shobha Patil":    [5,4,2,0],
  "Neha Kulkarni":   [5,3,1,0],
};
function getTrainingForMember(name) {
  const prog = TRAINING_PROGRESS[name] || [0,0,0,0];
  return TRAINING_CATALOG.map((m,i) => {
    const completed = prog[i];
    const total     = m.totalLessons;
    let status = completed === total ? "done"
               : completed > 0       ? "in-progress"
               : i === 0             ? "in-progress"
               : (prog[i-1] < TRAINING_CATALOG[i-1].totalLessons) ? "locked"
               : "in-progress";
    return { ...m, completed, status };
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIMULATED BANK UPI RECORDS  (the "bank's side")
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BANK_UPI_RECORDS = {
  // Shakti Mahila SHG â€” Sita Devi, Rani Kumari
  "UPI-TXN-20260128-9841": { amount: 5000,  payer: "Sita Devi",     status: "success" },
  "UPI-TXN-20260127-6610": { amount: 6000,  payer: "Sita Devi",     status: "success" },
  "UPI-TXN-20260130-1203": { amount: 3000,  payer: "Rani Kumari",   status: "success" },
  "UPI-TXN-20260201-8812": { amount: 7000,  payer: "Rani Kumari",   status: "success" },
  // Ujjwala SHG â€” Sunita Yadav, Kavita Singh
  "UPI-TXN-20260126-2210": { amount: 8000,  payer: "Sunita Yadav",  status: "success" },
  "UPI-TXN-20260131-4455": { amount: 5500,  payer: "Sunita Yadav",  status: "success" },
  "UPI-TXN-20260131-7754": { amount: 8000,  payer: "Kavita Singh",  status: "success" },
  "UPI-TXN-20260129-3380": { amount: 4500,  payer: "Kavita Singh",  status: "success" },
  // Pragati SHG â€” Rekha Devi, Asha Kumari
  "UPI-TXN-20260125-4421": { amount: 10000, payer: "Rekha Devi",    status: "success" },
  "UPI-TXN-20260201-5570": { amount: 2500,  payer: "Rekha Devi",    status: "success" },
  "UPI-TXN-20260128-7701": { amount: 4000,  payer: "Asha Kumari",   status: "success" },
  "UPI-TXN-20260130-9920": { amount: 3500,  payer: "Asha Kumari",   status: "success" },
  // Saraswati SHG â€” Savita Rao, Latha Iyer
  "UPI-TXN-20260127-1144": { amount: 9000,  payer: "Savita Rao",    status: "success" },
  "UPI-TXN-20260131-6630": { amount: 6500,  payer: "Savita Rao",    status: "success" },
  "UPI-TXN-20260129-8870": { amount: 7000,  payer: "Latha Iyer",    status: "success" },
  "UPI-TXN-20260201-2233": { amount: 5000,  payer: "Latha Iyer",    status: "success" },
  // Nirmala SHG â€” Kamala Reddy, Shobha Patil
  "UPI-TXN-20260126-5500": { amount: 11000, payer: "Kamala Reddy",  status: "success" },
  "UPI-TXN-20260130-7780": { amount: 8500,  payer: "Kamala Reddy",  status: "success" },
  "UPI-TXN-20260128-3344": { amount: 6000,  payer: "Shobha Patil",  status: "success" },
  "UPI-TXN-20260201-9910": { amount: 4000,  payer: "Shobha Patil",  status: "success" },
};

const PENDING_LOANS_INIT = [
  { id:"LN-2024-001", member:"Sita Devi",    requestedAmt:50000, purpose:"Tailoring Business", bankStatus:"verified", bankRef:"BNK-VRF-84721", submittedOn:"2024-11-12", status:"awaiting_admin", sanctionedAmt:null },
  { id:"LN-2024-002", member:"Rani Kumari",  requestedAmt:75000, purpose:"Grocery Shop",       bankStatus:"verified", bankRef:"BNK-VRF-91043", submittedOn:"2024-11-18", status:"awaiting_admin", sanctionedAmt:null },
  { id:"LN-2024-003", member:"Kavita Singh", requestedAmt:60000, purpose:"Organic Farm Setup", bankStatus:"verified", bankRef:"BNK-VRF-77652", submittedOn:"2024-11-20", status:"awaiting_admin", sanctionedAmt:null },
  { id:"LN-2024-004", member:"Lakshmi Bai",  requestedAmt:30000, purpose:"Handicraft Unit",    bankStatus:"pending",  bankRef:"â€”",             submittedOn:"2024-11-25", status:"bank_pending",   sanctionedAmt:null },
  { id:"LN-2024-005", member:"Rekha Devi",   requestedAmt:45000, purpose:"Parlour Setup",      bankStatus:"verified", bankRef:"BNK-VRF-65490", submittedOn:"2024-11-10", status:"approved",       sanctionedAmt:45000 },
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA SERVICE  (mirrors original dataService.js)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getMembersBySHG(shg) {
  return ALL_MEMBERS.filter((m) => m.SHGName === shg);
}
function getAllSHGs() {
  return [...new Set(ALL_MEMBERS.map((m) => m.SHGName))].sort();
}
function getSHGStats(shg) {
  const members = getMembersBySHG(shg);
  const n = members.length;
  const totalSavings = members.reduce((s, m) => s + m.Savings, 0);
  const activeLoans = members.filter((m) => m.LoanStatus === "Active");
  const avgAttendance = members.reduce((s, m) => s + m.Attendance, 0) / n;
  const onTimeEMI = activeLoans.filter((m) => m.EMIStatus === "On Time").length;
  const delayedEMI = activeLoans.filter((m) => m.EMIStatus === "Delayed").length;
  return {
    totalMembers: n,
    totalSavings,
    activeLoans: activeLoans.length,
    avgAttendance: Math.round(avgAttendance * 10) / 10,
    totalLoanAmount: activeLoans.reduce((s, m) => s + m.LoanAmount, 0),
    onTimeEMI,
    delayedEMI,
  };
}
function calculateHealthScore(shg) {
  const stats = getSHGStats(shg);
  const activeLoans = getMembersBySHG(shg).filter((m) => m.LoanStatus === "Active");
  let onTimePct = 100;
  if (activeLoans.length > 0)
    onTimePct = (activeLoans.filter((m) => m.EMIStatus === "On Time").length / activeLoans.length) * 100;
  return Math.round(((stats.avgAttendance + onTimePct) / 2) * 10) / 10;
}
function getHealthStatus(score) {
  if (score >= 90) return { status: "Excellent", cls: "success" };
  if (score >= 80) return { status: "Good", cls: "info" };
  if (score >= 70) return { status: "Fair", cls: "warning" };
  return { status: "Needs Attention", cls: "danger" };
}
function getAllSHGSummaries() {
  return getAllSHGs().map((name) => {
    const stats = getSHGStats(name);
    return { name, ...stats, healthScore: calculateHealthScore(name) };
  });
}
function fmt(n) {
  return "â‚¹" + n.toLocaleString("en-IN");
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SHARED UI HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BADGE_COLORS = {
  success: { bg: "rgba(46,125,50,.15)", color: "#2e7d32", border: "#2e7d32" },
  warning: { bg: "rgba(245,124,0,.15)", color: "#f57c00", border: "#f57c00" },
  danger: { bg: "rgba(198,40,40,.15)", color: "#c62828", border: "#c62828" },
  info: { bg: "rgba(2,119,189,.15)", color: "#0277bd", border: "#0277bd" },
  secondary: { bg: "rgba(0,137,123,.15)", color: "#00897b", border: "#00897b" },
};

function Badge({ type = "info", children }) {
  const c = BADGE_COLORS[type] || BADGE_COLORS.info;
  return (
    <span
      style={{
        display: "inline-block",
        padding: "3px 10px",
        fontSize: 11,
        fontWeight: 600,
        borderRadius: 20,
        textTransform: "uppercase",
        letterSpacing: 0.5,
        background: c.bg,
        color: c.color,
        border: `1px solid ${c.border}`,
      }}
    >
      {children}
    </span>
  );
}

function ProgressBar({ value, maxW = 120 }) {
  return (
    <div style={{ height: 7, background: "#d4c5ad", borderRadius: 4, width: maxW, overflow: "hidden" }}>
      <div
        style={{
          height: "100%",
          width: `${Math.min(value, 100)}%`,
          background: "linear-gradient(90deg,#00897b,#4db6ac)",
          borderRadius: 4,
          transition: "width .5s",
        }}
      />
    </div>
  );
}

function loanBadge(status) {
  const map = { Active: "info", Closed: "success", None: "secondary" };
  return <Badge type={map[status] || "secondary"}>{status}</Badge>;
}
function emiBadge(status) {
  const map = { "On Time": "success", Delayed: "danger", Completed: "success", "N/A": "secondary" };
  const icons = { "On Time": "âœ“ ", Delayed: "âš  ", Completed: "âœ“ " };
  return <Badge type={map[status] || "secondary"}>{(icons[status] || "") + status}</Badge>;
}
function attendanceBadge(att) {
  if (att >= 90) return <Badge type="success">Excellent</Badge>;
  if (att >= 80) return <Badge type="info">Good</Badge>;
  if (att >= 70) return <Badge type="warning">Fair</Badge>;
  return <Badge type="danger">Poor</Badge>;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LAYOUT SHELL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ALL_NAV_ITEMS = [
  { key: "dashboard",     label: "Dashboard",            icon: "ðŸ“Š", roles: ["leader","member"] },
  { key: "members",       label: "Members",              icon: "ðŸ‘¥", roles: ["leader"] },
  { key: "savings",       label: "Savings & Attendance", icon: "ðŸ’°", roles: ["leader","member"] },
  { key: "loans",         label: "Loans",                icon: "ðŸ“‹", roles: ["leader","member"] },
  { key: "meetings",      label: "Meetings",             icon: "ðŸ“…", roles: ["leader","member"] },
  { key: "notifications", label: "Notifications",        icon: "ðŸ””", roles: ["leader","member"] },
  { key: "training",      label: "Training",             icon: "ðŸŽ“", roles: ["leader","member"] },
  { key: "ngolocator",    label: "NGO Locator",          icon: "ðŸ¢", roles: ["leader"] },
  { key: "reports",       label: "Reports",              icon: "ðŸ“ˆ", roles: ["leader"] },
  { key: "insights",      label: "Insights",             icon: "ðŸ§ ", roles: ["leader"] },
  { key: "superadmin",    label: "Loan Sanctions",       icon: "ðŸ›¡ï¸", roles: ["superadmin"] },
];

function Sidebar({ selectedSHG, role, memberName, page, setPage, onSwitchSHG, onLogout }) {
  const navItems = ALL_NAV_ITEMS.filter((it) => it.roles.includes(role));
  const displayName = role === "superadmin" ? "Super Admin"
                    : role === "member" && memberName ? memberName
                    : selectedSHG || "â€”";
  const displaySub  = role === "superadmin" ? "Full System Access"
                    : role === "member" ? "Member Â· " + (selectedSHG || "")
                    : "SHG Leader";
  const avatarChar  = role === "superadmin" ? "SA"
                    : role === "member" && memberName ? memberName[0]
                    : selectedSHG ? selectedSHG[0] : "S";

  return (
    <aside
      style={{
        width: 248,
        minWidth: 248,
        background: "linear-gradient(180deg,#bf360c,#d84315)",
        color: "#fff",
        padding: "24px 0",
        display: "flex",
        flexDirection: "column",
        minHeight: "100vh",
        boxShadow: "4px 0 12px rgba(45,27,16,.15)",
      }}
    >
      {/* logo */}
      <div style={{ padding: "0 20px 20px", borderBottom: "1px solid rgba(255,255,255,.2)", marginBottom: 16 }}>
        <span style={{ fontSize: 20, fontWeight: 700, display: "flex", alignItems: "center", gap: 8 }}>
          <span style={{ color: "#ffa726", fontSize: 24 }}>â—†</span> SHG Platform
        </span>
      </div>
      {/* user */}
      <div style={{ margin: "0 16px 16px", padding: 16, background: "rgba(255,255,255,.1)", borderRadius: 12 }}>
        <div
          style={{
            width: 48, height: 48, borderRadius: "50%",
            background: "linear-gradient(135deg,#ffa726,#4db6ac)",
            display: "flex", alignItems: "center", justifyContent: "center",
            fontWeight: 700, fontSize: 18, marginBottom: 8,
          }}
        >
          {avatarChar}
        </div>
        <div style={{ fontWeight: 600, fontSize: 14 }}>{displayName}</div>
        <div style={{ fontSize: 11, color: "rgba(255,255,255,.65)", marginTop: 2 }}>{displaySub}</div>
      </div>
      {/* nav */}
      <nav style={{ flex: 1 }}>
        {navItems.map((item) => (
          <button
            key={item.key}
            onClick={() => setPage(item.key)}
            style={{
              display: "flex", alignItems: "center", gap: 10, width: "100%",
              padding: "10px 20px",
              background: page === item.key ? "rgba(255,255,255,.15)" : "transparent",
              border: "none",
              borderLeft: page === item.key ? "3px solid #ffa726" : "3px solid transparent",
              color: page === item.key ? "#fff" : "rgba(255,255,255,.82)",
              fontFamily: "inherit", fontSize: 14, fontWeight: 500,
              cursor: "pointer", textAlign: "left", transition: "all .2s",
            }}
          >
            <span>{item.icon}</span> {item.label}
          </button>
        ))}
        <hr style={{ border: "none", borderTop: "1px solid rgba(255,255,255,.15)", margin: "12px 0" }} />
        {role === "leader" && (
          <button
            onClick={onSwitchSHG}
            style={{
              display: "flex", alignItems: "center", gap: 10, width: "100%",
              padding: "10px 20px", background: "transparent", border: "none",
              borderLeft: "3px solid transparent", color: "rgba(255,255,255,.7)",
              fontFamily: "inherit", fontSize: 14, cursor: "pointer",
            }}
          >
            <span>ðŸ”„</span> Switch SHG
          </button>
        )}
        <button
          onClick={onLogout}
          style={{
            display: "flex", alignItems: "center", gap: 10, width: "100%",
            padding: "10px 20px", background: "transparent", border: "none",
            borderLeft: "3px solid transparent", color: "rgba(255,255,255,.7)",
            fontFamily: "inherit", fontSize: 14, cursor: "pointer",
          }}
        >
          <span>ðŸšª</span> Logout
        </button>
      </nav>
    </aside>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STAT CARD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function StatCard({ icon, value, label, gradientColor = "#d84315" }) {
  return (
    <div
      style={{
        background: "#fff",
        borderRadius: 12,
        padding: 20,
        boxShadow: "0 2px 8px rgba(45,27,16,.08)",
        border: "1px solid #d4c5ad",
        position: "relative",
        overflow: "hidden",
      }}
    >
      <div style={{ position: "absolute", top: 0, left: 0, right: 0, height: 4, background: `linear-gradient(90deg,${gradientColor},#ffa726)` }} />
      <div
        style={{
          width: 44,
          height: 44,
          borderRadius: 10,
          background: "linear-gradient(135deg,#ff7043,#ffa726)",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          fontSize: 20,
          marginBottom: 12,
        }}
      >
        {icon}
      </div>
      <div style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10" }}>{value}</div>
      <div style={{ fontSize: 11, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, color: "#5d4e37" }}>{label}</div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TABLE WRAPPER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DataTable({ headers, rows }) {
  return (
    <div style={{ overflowX: "auto", background: "#fff", borderRadius: 12, boxShadow: "0 2px 8px rgba(45,27,16,.08)", border: "1px solid #d4c5ad" }}>
      <table style={{ width: "100%", borderCollapse: "collapse" }}>
        <thead>
          <tr style={{ background: "linear-gradient(135deg,#d84315,#ff7043)" }}>
            {headers.map((h, i) => (
              <th key={i} style={{ padding: "10px 14px", textAlign: "left", color: "#fff", fontSize: 11, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, whiteSpace: "nowrap" }}>
                {h}
              </th>
            ))}
          </tr>
        </thead>
        <tbody>
          {rows.map((row, i) => (
            <tr key={i} style={{ borderBottom: "1px solid #d4c5ad", background: row._highlight || "transparent" }}>
              {row.cells.map((cell, j) => (
                <td key={j} style={{ padding: "10px 14px", color: "#5d4e37", fontSize: 13 }}>
                  {cell}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: DASHBOARD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DashboardPage({ selectedSHG, role, memberName, setPage }) {
  const stats   = useMemo(() => getSHGStats(selectedSHG), [selectedSHG]);
  const members = useMemo(() => getMembersBySHG(selectedSHG), [selectedSHG]);
  const me      = useMemo(() => members.find((m) => m.Name === memberName) || null, [members, memberName]);

  /* â”€â”€â”€ LEADER DASHBOARD â”€â”€â”€ */
  if (role === "leader") {
    const activities = [];
    members.forEach((m) => {
      if (m.LoanStatus === "Active")
        activities.push({ text: `${m.Name} has an active loan of ${fmt(m.LoanAmount)}`, type: "info" });
      if (m.EMIStatus === "Delayed")
        activities.push({ text: `EMI payment delayed for ${m.Name}`, type: "warning" });
    });

    const quickActions = [
      { label: "View All Members", target: "members",       icon: "ðŸ‘¥" },
      { label: "Manage Loans",     target: "loans",         icon: "ðŸ“‹" },
      { label: "Generate Reports", target: "reports",       icon: "ðŸ“ˆ" },
      { label: "View Insights",    target: "insights",      icon: "ðŸ§ " },
    ];

    return (
      <div>
        <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>Leader Dashboard</h1>
        <p style={{ color: "#5d4e37", marginBottom: 20 }}>Group overview â€” <strong>{selectedSHG}</strong></p>

        {/* alerts */}
        {stats.delayedEMI > 0 && (
          <div style={{ padding: "12px 16px", borderRadius: 8, borderLeft: "4px solid #f57c00", background: "rgba(245,124,0,.06)", color: "#f57c00", marginBottom: 16, fontSize: 13 }}>
            âš  <strong>{stats.delayedEMI} member(s)</strong> have delayed EMI payments. Please follow up.
          </div>
        )}
        {stats.delayedEMI === 0 && stats.onTimeEMI > 0 && (
          <div style={{ padding: "12px 16px", borderRadius: 8, borderLeft: "4px solid #2e7d32", background: "rgba(46,125,50,.06)", color: "#2e7d32", marginBottom: 16, fontSize: 13 }}>
            âœ“ All <strong>{stats.onTimeEMI}</strong> active loan EMIs are on time.
          </div>
        )}

        {/* stat cards */}
        <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(180px,1fr))", gap: 16, marginBottom: 24 }}>
          <StatCard icon="ðŸ‘¥" value={stats.totalMembers} label="Total Members" />
          <StatCard icon="ðŸ’°" value={fmt(stats.totalSavings)} label="Total Savings" />
          <StatCard icon="ðŸ“‹" value={stats.activeLoans} label="Active Loans" />
          <StatCard icon="ðŸ“Š" value={stats.avgAttendance + "%"} label="Avg Attendance" />
        </div>

        {/* bottom grid */}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20 }}>
          {/* quick actions â€” WIRED */}
          <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
            <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 16, paddingBottom: 10, borderBottom: "2px solid #d4c5ad" }}>Quick Actions</h3>
            {quickActions.map((qa) => (
              <button
                key={qa.target}
                onClick={() => setPage(qa.target)}
                style={{
                  display: "flex", alignItems: "center", gap: 10, width: "100%", marginBottom: 8,
                  padding: "10px 16px", background: "transparent",
                  border: "2px solid #d84315", borderRadius: 8,
                  color: "#d84315", fontWeight: 600, fontSize: 13,
                  cursor: "pointer", fontFamily: "inherit", transition: "all .2s",
                }}
                onMouseEnter={(e) => { e.currentTarget.style.background = "#d84315"; e.currentTarget.style.color = "#fff"; }}
                onMouseLeave={(e) => { e.currentTarget.style.background = "transparent"; e.currentTarget.style.color = "#d84315"; }}
              >
                <span>{qa.icon}</span> {qa.label}
              </button>
            ))}
          </div>
          {/* recent activity */}
          <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
            <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 16, paddingBottom: 10, borderBottom: "2px solid #d4c5ad" }}>Recent Activities</h3>
            {activities.slice(0, 5).map((a, i) => (
              <div key={i} style={{ display: "flex", alignItems: "flex-start", gap: 8, marginBottom: 10 }}>
                <Badge type={a.type}>{a.type}</Badge>
                <span style={{ fontSize: 12, color: "#5d4e37" }}>{a.text}</span>
              </div>
            ))}
            {activities.length === 0 && <p style={{ color: "#8b7355", fontSize: 13 }}>No recent activities.</p>}
          </div>
        </div>

        {/* health snapshot */}
        <div style={{ marginTop: 24, background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
          <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 12 }}>SHG Health Snapshot</h3>
          <div style={{ display: "flex", alignItems: "center", gap: 20, flexWrap: "wrap" }}>
            <div style={{ textAlign: "center" }}>
              <div style={{ fontSize: 36, fontWeight: 700, color: "#d84315" }}>{calculateHealthScore(selectedSHG)}</div>
              <div style={{ fontSize: 11, color: "#5d4e37", textTransform: "uppercase", letterSpacing: 0.5 }}>Health Score</div>
            </div>
            <div style={{ flex: 1, minWidth: 160 }}>
              <ProgressBar value={calculateHealthScore(selectedSHG)} maxW="100%" />
            </div>
            <Badge type={getHealthStatus(calculateHealthScore(selectedSHG)).cls}>{getHealthStatus(calculateHealthScore(selectedSHG)).status}</Badge>
          </div>
        </div>
      </div>
    );
  }

  /* â”€â”€â”€ MEMBER DASHBOARD â”€â”€â”€ */
  if (!me) {
    return (
      <div style={{ padding: 40, textAlign: "center", color: "#5d4e37" }}>
        <p style={{ fontSize: 16 }}>Could not find your profile. Please log in again.</p>
      </div>
    );
  }

  const hasLoan     = me.LoanStatus === "Active";
  const loanClosed  = me.LoanStatus === "Closed";
  const savingPct   = ((me.Savings / stats.totalSavings) * 100).toFixed(1);

  // personal activity
  const myActivity = [];
  if (hasLoan)      myActivity.push({ text: `Your active loan: ${fmt(me.LoanAmount)}`, type: me.EMIStatus === "Delayed" ? "warning" : "info" });
  if (hasLoan && me.EMIStatus === "Delayed") myActivity.push({ text: "Your EMI payment is delayed. Please contact your leader.", type: "warning" });
  if (hasLoan && me.EMIStatus === "On Time")  myActivity.push({ text: "Your EMI is on time. Great job!", type: "success" });
  if (loanClosed)   myActivity.push({ text: `You successfully completed your loan of ${fmt(me.LoanAmount)}.`, type: "success" });
  if (me.Savings >= 20000) myActivity.push({ text: `Congratulations! Your savings crossed â‚¹20,000.`, type: "success" });
  myActivity.push({ text: `Next group meeting: February 15, 2026 at 10:00 AM.`, type: "info" });

  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>My Dashboard</h1>
      <p style={{ color: "#5d4e37", marginBottom: 20 }}>Welcome, <strong>{me.Name}</strong> â€” {selectedSHG}</p>

      {/* profile card */}
      <div style={{ background: "#fff", borderRadius: 16, padding: 24, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 24, display: "flex", gap: 24, alignItems: "flex-start", flexWrap: "wrap" }}>
        {/* avatar */}
        <div style={{ textAlign: "center", minWidth: 100 }}>
          <div style={{
            width: 80, height: 80, borderRadius: "50%",
            background: "linear-gradient(135deg,#d84315,#ffa726)",
            display: "flex", alignItems: "center", justifyContent: "center",
            fontSize: 32, fontWeight: 700, color: "#fff", margin: "0 auto 10px",
          }}>
            {me.Name[0]}
          </div>
          <Badge type="info">{me.Role}</Badge>
        </div>
        {/* details */}
        <div style={{ flex: 1, minWidth: 200 }}>
          <h2 style={{ fontSize: 20, fontWeight: 700, color: "#2d1b10", marginBottom: 2 }}>{me.Name}</h2>
          <p style={{ color: "#5d4e37", fontSize: 13, marginBottom: 12 }}>Age {me.Age} Â· Joined {me.JoinDate} Â· {selectedSHG}</p>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            {[
              { label: "Attendance", value: me.Attendance + "%", sub: me.Attendance >= 90 ? "Excellent" : me.Attendance >= 80 ? "Good" : "Fair" },
              { label: "Savings",    value: fmt(me.Savings),     sub: savingPct + "% of group total" },
            ].map((item) => (
              <div key={item.label} style={{ background: "#f5f1e8", borderRadius: 10, padding: "10px 14px" }}>
                <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>{item.label}</div>
                <div style={{ fontSize: 18, fontWeight: 700, color: "#2d1b10", marginTop: 2 }}>{item.value}</div>
                <div style={{ fontSize: 11, color: "#5d4e37" }}>{item.sub}</div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* stat cards â€“ personal only */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(160px,1fr))", gap: 16, marginBottom: 24 }}>
        <StatCard icon="ðŸ“Š" value={me.Attendance + "%"} label="My Attendance" />
        <StatCard icon="ðŸ’°" value={fmt(me.Savings)} label="My Savings" />
        <StatCard icon="ðŸ“‹" value={me.LoanStatus === "None" ? "None" : fmt(me.LoanAmount)} label="My Loan" />
        <StatCard icon="âœ“"  value={me.EMIStatus === "N/A" ? "â€”" : me.EMIStatus} label="EMI Status" gradientColor={me.EMIStatus === "Delayed" ? "#c62828" : "#2e7d32"} />
      </div>

      {/* attendance progress */}
      <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 20 }}>
        <h3 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>Attendance Progress</h3>
        <div style={{ display: "flex", alignItems: "center", gap: 14 }}>
          <ProgressBar value={me.Attendance} maxW={240} />
          <span style={{ fontSize: 14, fontWeight: 600, color: "#2d1b10" }}>{me.Attendance}%</span>
          {attendanceBadge(me.Attendance)}
        </div>
        <p style={{ fontSize: 12, color: "#8b7355", marginTop: 8 }}>
          {me.Attendance >= 90 ? "Keep it up! You have excellent attendance." : me.Attendance >= 80 ? "Good attendance. Try to attend more meetings to reach Excellent." : "Consider attending more meetings to improve your record."}
        </p>
      </div>

      {/* loan status card (only if has/had loan) */}
      {me.LoanStatus !== "None" && (
        <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 20 }}>
          <h3 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 12 }}>Loan Details</h3>
          <div style={{ display: "flex", gap: 20, flexWrap: "wrap" }}>
            <div style={{ flex: 1, minWidth: 140 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>Loan Amount</div>
              <div style={{ fontSize: 22, fontWeight: 700, color: "#2d1b10" }}>{fmt(me.LoanAmount)}</div>
            </div>
            <div style={{ flex: 1, minWidth: 140 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>Status</div>
              <div style={{ marginTop: 4 }}>{loanBadge(me.LoanStatus)}</div>
            </div>
            <div style={{ flex: 1, minWidth: 140 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>EMI Status</div>
              <div style={{ marginTop: 4 }}>{emiBadge(me.EMIStatus)}</div>
            </div>
          </div>
        </div>
      )}

      {/* personal activity feed */}
      <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
        <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 16, paddingBottom: 10, borderBottom: "2px solid #d4c5ad" }}>Your Activity</h3>
        {myActivity.map((a, i) => (
          <div key={i} style={{ display: "flex", alignItems: "flex-start", gap: 10, marginBottom: 10 }}>
            <Badge type={a.type}>{a.type}</Badge>
            <span style={{ fontSize: 12.5, color: "#5d4e37" }}>{a.text}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: MEMBERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function MembersPage({ selectedSHG }) {
  const members = useMemo(() => getMembersBySHG(selectedSHG), [selectedSHG]);
  const rows = members.map((m) => ({
    cells: [
      <strong>{m.Name}</strong>,
      <Badge type="info">{m.Role}</Badge>,
      m.Age,
      <span style={{ display: "flex", alignItems: "center", gap: 6 }}>
        {m.Attendance}% <ProgressBar value={m.Attendance} maxW={80} /> {attendanceBadge(m.Attendance)}
      </span>,
      <strong>{fmt(m.Savings)}</strong>,
      loanBadge(m.LoanStatus),
      emiBadge(m.EMIStatus),
      m.JoinDate,
    ],
  }));
  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>Member Management</h1>
      <p style={{ color: "#5d4e37", marginBottom: 20 }}>
        {selectedSHG} â€” <strong>{members.length} members</strong>
      </p>
      <DataTable
        headers={["Name", "Role", "Age", "Attendance", "Savings", "Loan", "EMI", "Joined"]}
        rows={rows}
      />
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: SAVINGS & ATTENDANCE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SavingsPage({ selectedSHG, role, memberName }) {
  const members = useMemo(() => getMembersBySHG(selectedSHG), [selectedSHG]);
  const stats = useMemo(() => getSHGStats(selectedSHG), [selectedSHG]);
  const me = useMemo(() => members.find((m) => m.Name === memberName) || null, [members, memberName]);
  const excellentCount = members.filter((m) => m.Attendance >= 90).length;
  const avgSavings = Math.round(stats.totalSavings / stats.totalMembers);

  const savingsSorted = [...members].sort((a, b) => b.Savings - a.Savings);
  const attSorted = [...members].sort((a, b) => b.Attendance - a.Attendance);

  function savingStatus(s) {
    if (s >= 20000) return { label: "Excellent", type: "success" };
    if (s >= 15000) return { label: "Good", type: "info" };
    if (s >= 10000) return { label: "Fair", type: "warning" };
    return { label: "Growing", type: "secondary" };
  }

  /* â”€â”€â”€ MEMBER VIEW â”€â”€â”€ */
  if (role === "member" && me) {
    const savPct = ((me.Savings / stats.totalSavings) * 100).toFixed(1);
    const ss = savingStatus(me.Savings);
    const myRank = savingsSorted.findIndex((m) => m.Name === me.Name) + 1;
    const attRank = attSorted.findIndex((m) => m.Name === me.Name) + 1;
    return (
      <div>
        <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>My Savings & Attendance</h1>
        <p style={{ color: "#5d4e37", marginBottom: 20 }}>Your personal savings and participation overview</p>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(160px,1fr))", gap: 16, marginBottom: 24 }}>
          <StatCard icon="ðŸ’°" value={fmt(me.Savings)} label="My Savings" />
          <StatCard icon="ðŸ“Š" value={me.Attendance + "%"} label="My Attendance" />
          <StatCard icon="ðŸ“ˆ" value={savPct + "%"} label="Group Contribution" />
          <StatCard icon="ðŸ…" value={"#" + myRank} label="Savings Rank" gradientColor="#00897b" />
        </div>

        {/* savings card */}
        <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 20 }}>
          <h3 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 14 }}>Savings Details</h3>
          <div style={{ display: "flex", gap: 20, flexWrap: "wrap" }}>
            <div style={{ flex: 1, minWidth: 140, background: "#f5f1e8", borderRadius: 10, padding: 16 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>Total Saved</div>
              <div style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginTop: 4 }}>{fmt(me.Savings)}</div>
              <div style={{ marginTop: 6 }}><Badge type={ss.type}>{ss.label}</Badge></div>
            </div>
            <div style={{ flex: 1, minWidth: 140, background: "#f5f1e8", borderRadius: 10, padding: 16 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>% of Group Total</div>
              <div style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginTop: 4 }}>{savPct}%</div>
              <div style={{ marginTop: 8 }}><ProgressBar value={parseFloat(savPct) * 5} maxW={120} /></div>
            </div>
            <div style={{ flex: 1, minWidth: 140, background: "#f5f1e8", borderRadius: 10, padding: 16 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>Savings Rank</div>
              <div style={{ fontSize: 24, fontWeight: 700, color: "#00897b", marginTop: 4 }}>#{myRank} <span style={{ fontSize: 13, color: "#5d4e37" }}>of {members.length}</span></div>
            </div>
          </div>
        </div>

        {/* attendance card */}
        <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
          <h3 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 14 }}>Attendance Details</h3>
          <div style={{ display: "flex", alignItems: "center", gap: 16, marginBottom: 14 }}>
            <ProgressBar value={me.Attendance} maxW={260} />
            <span style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10" }}>{me.Attendance}%</span>
            {attendanceBadge(me.Attendance)}
          </div>
          <div style={{ display: "flex", gap: 16, flexWrap: "wrap" }}>
            <div style={{ background: "#f5f1e8", borderRadius: 10, padding: "10px 16px", flex: 1, minWidth: 140 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase" }}>Attendance Rank</div>
              <div style={{ fontSize: 20, fontWeight: 700, color: "#00897b", marginTop: 2 }}>#{attRank} <span style={{ fontSize: 12, color: "#5d4e37" }}>of {members.length}</span></div>
            </div>
            <div style={{ background: "#f5f1e8", borderRadius: 10, padding: "10px 16px", flex: 1, minWidth: 140 }}>
              <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase" }}>Group Average</div>
              <div style={{ fontSize: 20, fontWeight: 700, color: "#2d1b10", marginTop: 2 }}>{stats.avgAttendance}%</div>
            </div>
          </div>
          <p style={{ fontSize: 12, color: "#8b7355", marginTop: 12 }}>
            {me.Attendance >= 90 ? "Excellent attendance! You are among the top contributors." : me.Attendance >= 80 ? "Good attendance. A few more meetings will get you to Excellent." : "Try attending more meetings to improve your record."}
          </p>
        </div>
      </div>
    );
  }

  /* â”€â”€â”€ LEADER VIEW (full group) â”€â”€â”€ */
  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>Savings & Attendance</h1>
      <p style={{ color: "#5d4e37", marginBottom: 20 }}>Track member savings and meeting participation</p>

      <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(170px,1fr))", gap: 16, marginBottom: 24 }}>
        <StatCard icon="ðŸ’°" value={fmt(stats.totalSavings)} label="Total Savings" />
        <StatCard icon="ðŸ“Š" value={fmt(avgSavings)} label="Avg Savings" />
        <StatCard icon="âœ“" value={stats.avgAttendance + "%"} label="Avg Attendance" />
        <StatCard icon="â­" value={excellentCount} label="Excellent Attendance" />
      </div>

      <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>Member Savings</h3>
      <DataTable
        headers={["Name", "Role", "Savings", "Contribution %", "Status"]}
        rows={savingsSorted.map((m) => {
          const pct = ((m.Savings / stats.totalSavings) * 100).toFixed(1);
          const s = savingStatus(m.Savings);
          return {
            cells: [<strong>{m.Name}</strong>, <Badge type="info">{m.Role}</Badge>, <strong>{fmt(m.Savings)}</strong>, pct + "%", <Badge type={s.type}>{s.label}</Badge>],
          };
        })}
      />

      <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginTop: 24, marginBottom: 10 }}>Attendance Summary</h3>
      <DataTable
        headers={["Name", "Role", "Rate", "Progress", "Status"]}
        rows={attSorted.map((m) => ({
          cells: [<strong>{m.Name}</strong>, <Badge type="info">{m.Role}</Badge>, m.Attendance + "%", <ProgressBar value={m.Attendance} maxW={140} />, attendanceBadge(m.Attendance)],
        }))}
      />
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: LOANS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LoansPage({ selectedSHG, role, memberName }) {
  const [loanAmounts, setLoanAmounts] = useState(() => {
    const init = {};
    ALL_MEMBERS.forEach(m => { init[m.Name] = m.LoanAmount; });
    return init;
  });

  // â”€â”€ BANK VERIFICATION STATE (leader) â”€â”€
  const [pendingApprovals, setPendingApprovals] = useState([]); // verified but not yet leader-approved
  const [approvedList, setApprovedList] = useState([]);   // leader-approved history
  const [leaderTab, setLeaderTab]       = useState("loans"); // "loans" | "verify" | "approvals"
  const [toast, setToast]               = useState(null);

  function showToast(msg) { setToast(msg); setTimeout(() => setToast(null), 2400); }

  // â”€â”€ Derived data â”€â”€
  const members   = useMemo(() => getMembersBySHG(selectedSHG), [selectedSHG]);
  const me        = useMemo(() => members.find((m) => m.Name === memberName) || null, [members, memberName]);
  // Use live loanAmounts for display
  const loansData = members.filter((m) => m.LoanStatus !== "None").map(m => ({ ...m, LoanAmount: loanAmounts[m.Name] ?? m.LoanAmount }));
  const stats     = useMemo(() => getSHGStats(selectedSHG), [selectedSHG]);
  const closed    = loansData.filter((l) => l.LoanStatus === "Closed").length;
  const totalAmt  = loansData.reduce((s, l) => s + l.LoanAmount, 0);
  const activeMembers = members.filter(m => m.LoanStatus === "Active");

  // â”€â”€ Leader approves â†’ loan amount reduces â”€â”€
  function approvePending(entry) {
    const currentLoan = loanAmounts[entry.member] ?? 0;
    const newLoan = Math.max(0, currentLoan - entry.amount);
    setLoanAmounts(prev => ({ ...prev, [entry.member]: newLoan }));
    setPendingApprovals(prev => prev.filter(p => p.id !== entry.id));
    setApprovedList(prev => [...prev, { ...entry, approvedAt: new Date().toLocaleString("en-IN"), previousLoan: currentLoan, newLoan }]);
    showToast(`âœ“ Approved! ${entry.member}'s loan reduced by ${fmt(entry.amount)} â†’ now ${fmt(newLoan)}`);
  }

  /* â”€â”€â”€ MEMBER VIEW â”€â”€â”€ */
  if (role === "member") {
    const myLoan = me ? (loanAmounts[me.Name] ?? me.LoanAmount) : 0;
    const hasLoan = me && me.LoanStatus !== "None";
    return (
      <div>
        <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>My Loan</h1>
        <p style={{ color: "#5d4e37", marginBottom: 20 }}>Your personal loan and EMI status</p>

        {!hasLoan ? (
          <div style={{ background: "#fff", borderRadius: 12, padding: 32, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", textAlign: "center" }}>
            <div style={{ fontSize: 48, marginBottom: 12 }}>ðŸ“‹</div>
            <h3 style={{ fontSize: 18, fontWeight: 700, color: "#2d1b10", marginBottom: 6 }}>No Active Loan</h3>
            <p style={{ color: "#5d4e37", fontSize: 14 }}>You currently don't have any loan. Contact your SHG leader to apply for one.</p>
          </div>
        ) : (
          <>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(160px,1fr))", gap: 16, marginBottom: 24 }}>
              <StatCard icon="ðŸ’°" value={fmt(myLoan)} label="Loan Amount" />
              <StatCard icon="ðŸ“‹" value={me.LoanStatus} label="Loan Status" gradientColor={me.LoanStatus === "Active" ? "#0277bd" : "#2e7d32"} />
              <StatCard icon="âœ“" value={me.EMIStatus} label="EMI Status" gradientColor={me.EMIStatus === "Delayed" ? "#c62828" : me.EMIStatus === "Completed" ? "#2e7d32" : "#0277bd"} />
            </div>

            {me.EMIStatus === "Delayed" && (
              <div style={{ padding: "12px 16px", borderRadius: 8, borderLeft: "4px solid #c62828", background: "rgba(198,40,40,.06)", color: "#c62828", marginBottom: 16, fontSize: 13 }}>
                âš  <strong>Important:</strong> Your EMI payment is delayed. Please contact your SHG leader to resolve this.
              </div>
            )}
            {me.EMIStatus === "On Time" && (
              <div style={{ padding: "12px 16px", borderRadius: 8, borderLeft: "4px solid #2e7d32", background: "rgba(46,125,50,.06)", color: "#2e7d32", marginBottom: 16, fontSize: 13 }}>
                âœ“ Your EMI payment is on time. Keep it up!
              </div>
            )}

            <div style={{ background: "#fff", borderRadius: 12, padding: 24, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
              <h3 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 16 }}>Loan Details</h3>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
                {[
                  { label: "Loan Amount", value: fmt(myLoan), icon: "ðŸ’°" },
                  { label: "Loan Status", value: me.LoanStatus, icon: "ðŸ“‹", badge: loanBadge(me.LoanStatus) },
                  { label: "EMI Status", value: me.EMIStatus, icon: "âœ“", badge: emiBadge(me.EMIStatus) },
                  { label: "Member Since", value: me.JoinDate, icon: "ðŸ“…" },
                ].map((item) => (
                  <div key={item.label} style={{ background: "#f5f1e8", borderRadius: 10, padding: 16 }}>
                    <div style={{ fontSize: 11, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.5 }}>{item.icon} {item.label}</div>
                    <div style={{ marginTop: 6 }}>{item.badge || <span style={{ fontSize: 17, fontWeight: 700, color: "#2d1b10" }}>{item.value}</span>}</div>
                  </div>
                ))}
              </div>
            </div>
          </>
        )}
      </div>
    );
  }

  /* â”€â”€â”€ LEADER VIEW â”€â”€â”€ */
  // Tab bar
  const tabs = [
    { key: "loans",      label: "Loan Overview",       icon: "ðŸ“‹" },
    { key: "verify",     label: "Bank Verification",   icon: "ðŸ¦", badge: null },
    { key: "approvals",  label: "Pending Approvals",   icon: "â³", badge: pendingApprovals.length || null },
  ];

  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>Loan Management</h1>
      <p style={{ color: "#5d4e37", marginBottom: 16 }}>Track loans, verify bank payments & approve repayments</p>

      {/* TAB BAR */}
      <div style={{ display: "flex", gap: 6, marginBottom: 22, background: "#f5f1e8", borderRadius: 10, padding: 5, width: "fit-content" }}>
        {tabs.map(t => (
          <button key={t.key} onClick={() => setLeaderTab(t.key)} style={{
            display: "flex", alignItems: "center", gap: 6, padding: "8px 16px", border: "none", borderRadius: 8,
            background: leaderTab === t.key ? "#fff" : "transparent",
            color: leaderTab === t.key ? "#d84315" : "#5d4e37",
            fontWeight: leaderTab === t.key ? 700 : 500, fontSize: 13, cursor: "pointer",
            fontFamily: "inherit", boxShadow: leaderTab === t.key ? "0 2px 6px rgba(0,0,0,.1)" : "none",
            transition: "all .2s", position: "relative",
          }}>
            {t.icon} {t.label}
            {t.badge && (
              <span style={{
                background: "#d84315", color: "#fff", fontSize: 10, fontWeight: 700,
                borderRadius: 10, padding: "1px 6px", minWidth: 18, textAlign: "center",
              }}>{t.badge}</span>
            )}
          </button>
        ))}
      </div>

      {/* â•â•â•â•â•â•â•â•â•â•â• TAB: LOAN OVERVIEW (original) â•â•â•â•â•â•â•â•â•â•â• */}
      {leaderTab === "loans" && (
        <div>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(170px,1fr))", gap: 16, marginBottom: 24 }}>
            <StatCard icon="ðŸ“‹" value={loansData.length} label="Total Loans" />
            <StatCard icon="ðŸ“Š" value={stats.activeLoans} label="Active Loans" />
            <StatCard icon="âœ“" value={closed} label="Closed Loans" />
            <StatCard icon="ðŸ’°" value={fmt(totalAmt)} label="Total Loan Amount" />
          </div>

          {stats.delayedEMI > 0 && (
            <div style={{ padding: "10px 14px", borderRadius: 8, borderLeft: "4px solid #f57c00", background: "rgba(245,124,0,.06)", color: "#f57c00", marginBottom: 16, fontSize: 13 }}>
              âš  <strong>Important:</strong> Rows highlighted in red indicate members with delayed EMI payments.
            </div>
          )}

          <DataTable
            headers={["Member", "Role", "Amount", "Loan Status", "EMI Status", "Date"]}
            rows={loansData.map((m) => {
              const original = ALL_MEMBERS.find(x => x.Name === m.Name);
              const wasReduced = original && m.LoanAmount < original.LoanAmount;
              return {
                _highlight: m.EMIStatus === "Delayed" ? "rgba(198,40,40,.06)" : wasReduced ? "rgba(46,125,50,.07)" : undefined,
                cells: [
                  <strong>{m.Name}</strong>,
                  <Badge type="info">{m.Role}</Badge>,
                  <span>
                    <strong>{fmt(m.LoanAmount)}</strong>
                    {wasReduced && (
                      <span style={{ display: "inline-flex", alignItems: "center", gap: 4, marginLeft: 8, fontSize: 11, color: "#2e7d32", fontWeight: 600, background: "rgba(46,125,50,.1)", padding: "2px 7px", borderRadius: 10 }}>
                        â†“ was {fmt(original.LoanAmount)}
                      </span>
                    )}
                  </span>,
                  loanBadge(m.LoanStatus),
                  emiBadge(m.EMIStatus),
                  m.JoinDate,
                ],
              };
            })}
          />

          {/* guide cards */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16, marginTop: 24 }}>
            {[
              {
                title: "Loan Decision Process",
                items: ["Review member's savings & attendance", "Verify loan purpose and amount", "Group voting and decision", "Set EMI schedule and track payments"],
              },
              {
                title: "EMI Tracking Tips",
                items: ["Send reminders 3 days before due date", "Follow up immediately on delays", "Document all payment transactions", "Review loan portfolio monthly"],
              },
            ].map((card) => (
              <div key={card.title} style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
                <h4 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>{card.title}</h4>
                {card.items.map((it, i) => (
                  <p key={i} style={{ fontSize: 12.5, color: "#5d4e37", marginBottom: 5 }}>
                    <strong>Step {i + 1}:</strong> {it}
                  </p>
                ))}
              </div>
            ))}
          </div>
        </div>
      )}

      {/* â•â•â•â•â•â•â•â•â•â•â• TAB: BANK VERIFICATION â•â•â•â•â•â•â•â•â•â•â• */}
      {leaderTab === "verify" && (() => {
        // derive transactions scoped to THIS SHG's active members only
        const activeMemberNames = new Set(activeMembers.map(m => m.Name));
        const shgTxns = Object.entries(BANK_UPI_RECORDS)
          .filter(([, rec]) => activeMemberNames.has(rec.payer))
          .map(([txnId, rec]) => ({ txnId, ...rec, currentLoan: loanAmounts[rec.payer] ?? 0 }));
        // track which txnIds are already pending or already approved this session
        const pendingTxnIds  = new Set(pendingApprovals.map(p => p.txnId));
        const approvedTxnIds = new Set(approvedList.map(a => a.txnId));

        return (
        <div>
          {/* how-it-works banner */}
          <div style={{ background: "rgba(2,119,189,.07)", border: "1px solid rgba(2,119,189,.2)", borderRadius: 10, padding: "12px 16px", marginBottom: 20, fontSize: 12.5, color: "#0277bd", display: "flex", gap: 10, alignItems: "flex-start" }}>
            <span style={{ fontSize: 20 }}>â„¹ï¸</span>
            <div>
              <strong>How Bank Verification Works:</strong> All UPI transactions received from the bank for your SHG members are listed below. Review each one and click <strong>Send for Approval</strong> to move it to the Pending Approvals queue. Only after your final approval on the next tab will the member's loan balance reduce.
            </div>
          </div>

          {/* summary row */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 16, marginBottom: 22 }}>
            <StatCard icon="ðŸ“¥" value={shgTxns.length}                                          label="Total Transactions"   gradientColor="#0277bd" />
            <StatCard icon="â³" value={shgTxns.filter(t => pendingTxnIds.has(t.txnId)).length}  label="Pending Approval"    gradientColor="#f57c00" />
            <StatCard icon="âœ“"  value={shgTxns.filter(t => approvedTxnIds.has(t.txnId)).length} label="Already Approved"    gradientColor="#2e7d32" />
          </div>

          {/* transaction cards grid */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(300px, 1fr))", gap: 14 }}>
            {shgTxns.map(txn => {
              const isPending  = pendingTxnIds.has(txn.txnId);
              const isApproved = approvedTxnIds.has(txn.txnId);
              const afterLoan  = Math.max(0, txn.currentLoan - txn.amount);

              // colour coding
              const cardBg   = isApproved ? "rgba(46,125,50,.06)"  : isPending ? "rgba(245,124,0,.06)"  : "#fff";
              const cardBord = isApproved ? "rgba(46,125,50,.3)"   : isPending ? "rgba(245,124,0,.3)"   : "#d4c5ad";

              return (
                <div key={txn.txnId} style={{ background: cardBg, border: `1px solid ${cardBord}`, borderRadius: 12, padding: 18, display: "flex", flexDirection: "column", gap: 12 }}>
                  {/* header row: avatar + name + badge */}
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                    <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                      <div style={{ width: 36, height: 36, borderRadius: "50%", background: "linear-gradient(135deg,#d84315,#ffa726)", display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontWeight: 700, fontSize: 15, flexShrink: 0 }}>{txn.payer[0]}</div>
                      <div>
                        <div style={{ fontWeight: 700, fontSize: 14, color: "#2d1b10" }}>{txn.payer}</div>
                        <div style={{ fontSize: 10.5, fontFamily: "monospace", color: "#8b7355" }}>{txn.txnId}</div>
                      </div>
                    </div>
                    <Badge type={isApproved ? "success" : isPending ? "warning" : "info"}>
                      {isApproved ? "âœ“ Approved" : isPending ? "â³ Pending" : "New"}
                    </Badge>
                  </div>

                  {/* amounts row */}
                  <div style={{ display: "flex", gap: 10, justifyContent: "space-between", background: "rgba(0,0,0,.03)", borderRadius: 8, padding: "10px 14px" }}>
                    <div style={{ textAlign: "center", flex: 1 }}>
                      <div style={{ fontSize: 10, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.4 }}>Repayment</div>
                      <div style={{ fontSize: 17, fontWeight: 700, color: "#0277bd", marginTop: 2 }}>{fmt(txn.amount)}</div>
                    </div>
                    <div style={{ textAlign: "center", flex: 1 }}>
                      <div style={{ fontSize: 10, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.4 }}>Current Loan</div>
                      <div style={{ fontSize: 17, fontWeight: 700, color: "#2d1b10", marginTop: 2 }}>{fmt(txn.currentLoan)}</div>
                    </div>
                    <div style={{ textAlign: "center", flex: 1 }}>
                      <div style={{ fontSize: 10, color: "#8b7355", textTransform: "uppercase", letterSpacing: 0.4 }}>After Approval</div>
                      <div style={{ fontSize: 17, fontWeight: 700, color: "#2e7d32", marginTop: 2 }}>{fmt(afterLoan)}</div>
                    </div>
                  </div>

                  {/* action button */}
                  {!isPending && !isApproved && (
                    <button onClick={() => {
                      const entry = {
                        id: "VRF-" + Date.now().toString(36).toUpperCase(),
                        member: txn.payer,
                        txnId: txn.txnId,
                        amount: txn.amount,
                        verifiedAt: new Date().toLocaleString("en-IN"),
                      };
                      setPendingApprovals(prev => [...prev, entry]);
                      showToast(`Sent for approval â€” ${txn.payer} Â· ${fmt(txn.amount)}`);
                    }} style={{
                      width: "100%", padding: "9px", border: "none", borderRadius: 8,
                      background: "linear-gradient(135deg,#0277bd,#29b6f6)", color: "#fff",
                      fontSize: 13, fontWeight: 600, cursor: "pointer", fontFamily: "inherit",
                    }}>
                      âž¡ï¸ Send for Approval
                    </button>
                  )}
                  {isPending && (
                    <div style={{ textAlign: "center", fontSize: 12, color: "#f57c00", fontWeight: 600, padding: "6px 0" }}>
                      â³ Awaiting your approval on the Approvals tab
                    </div>
                  )}
                  {isApproved && (
                    <div style={{ textAlign: "center", fontSize: 12, color: "#2e7d32", fontWeight: 600, padding: "6px 0" }}>
                      âœ“ Loan already reduced
                    </div>
                  )}
                </div>
              );
            })}
          </div>

          {shgTxns.length === 0 && (
            <div style={{ background: "#fff", borderRadius: 12, padding: 40, border: "1px solid #d4c5ad", textAlign: "center", color: "#8b7355" }}>
              <div style={{ fontSize: 40, marginBottom: 8 }}>ðŸ¦</div>
              <p style={{ fontSize: 14 }}>No bank transactions available for this SHG's active members.</p>
            </div>
          )}
        </div>
        );
      })()}

      {/* â•â•â•â•â•â•â•â•â•â•â• TAB: PENDING APPROVALS â•â•â•â•â•â•â•â•â•â•â• */}
      {leaderTab === "approvals" && (
        <div>
          {/* summary cards */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 16, marginBottom: 22 }}>
            <StatCard icon="â³" value={pendingApprovals.length} label="Pending Approval" gradientColor="#f57c00" />
            <StatCard icon="âœ“"  value={approvedList.length}    label="Approved This Session" gradientColor="#2e7d32" />
            <StatCard icon="ðŸ’°" value={fmt(approvedList.reduce((s,a)=>s+a.amount,0))} label="Total Repaid (Session)" gradientColor="#0277bd" />
          </div>

          {/* Pending queue */}
          <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 22 }}>
            <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>â³ Awaiting Your Approval</h3>
            <p style={{ fontSize: 12, color: "#8b7355", marginBottom: 16 }}>These transactions have been verified by the bank. Approve each one to reduce the member's loan balance.</p>

            {pendingApprovals.length === 0 ? (
              <div style={{ textAlign: "center", padding: "28px 0", color: "#8b7355", fontSize: 14 }}>
                <div style={{ fontSize: 36, marginBottom: 8 }}>ðŸ“¬</div>
                No pending approvals. Go to <strong>Bank Verification</strong> tab to verify transactions first.
              </div>
            ) : (
              <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                {pendingApprovals.map(entry => {
                  const currentLoan = loanAmounts[entry.member] ?? 0;
                  const afterLoan   = Math.max(0, currentLoan - entry.amount);
                  return (
                    <div key={entry.id} style={{ background: "#fffbf0", border: "1px solid #f0dcc0", borderRadius: 10, padding: 16, display: "flex", justifyContent: "space-between", alignItems: "center", gap: 12 }}>
                      <div style={{ flex: 1 }}>
                        <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 6 }}>
                          <div style={{ width: 32, height: 32, borderRadius: "50%", background: "linear-gradient(135deg,#d84315,#ffa726)", display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontWeight: 700, fontSize: 13 }}>{entry.member[0]}</div>
                          <div>
                            <strong style={{ fontSize: 14, color: "#2d1b10" }}>{entry.member}</strong>
                            <span style={{ fontSize: 11, color: "#8b7355", marginLeft: 8 }}>Txn: <span style={{ fontFamily: "monospace" }}>{entry.txnId}</span></span>
                          </div>
                        </div>
                        <div style={{ fontSize: 12, color: "#5d4e37", paddingLeft: 40 }}>
                          Repayment: <strong style={{ color: "#0277bd" }}>{fmt(entry.amount)}</strong>
                          &nbsp;Â·&nbsp; Current Loan: <strong>{fmt(currentLoan)}</strong>
                          &nbsp;â†’&nbsp; After Approval: <strong style={{ color: "#2e7d32" }}>{fmt(afterLoan)}</strong>
                        </div>
                        <div style={{ fontSize: 10.5, color: "#8b7355", paddingLeft: 40, marginTop: 3 }}>Verified at: {entry.verifiedAt}</div>
                      </div>
                      <button onClick={() => approvePending(entry)} style={{
                        padding: "9px 20px", border: "none", borderRadius: 8,
                        background: "linear-gradient(135deg,#d84315,#ff7043)", color: "#fff",
                        fontSize: 13, fontWeight: 700, cursor: "pointer", fontFamily: "inherit",
                        boxShadow: "0 3px 10px rgba(216,67,21,.3)", whiteSpace: "nowrap",
                      }}>
                        âœ“ Approve
                      </button>
                    </div>
                  );
                })}
              </div>
            )}
          </div>

          {/* Approved history */}
          {approvedList.length > 0 && (
            <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
              <h3 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 12 }}>âœ“ Approved Repayments</h3>
              <div style={{ overflowX: "auto" }}>
                <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 13 }}>
                  <thead>
                    <tr style={{ background: "linear-gradient(135deg,#2e7d32,#66bb6a)" }}>
                      {["Member","Txn ID","Repaid","Before","After","Approved At"].map(h => (
                        <th key={h} style={{ padding: "8px 12px", textAlign: "left", color: "#fff", fontSize: 11, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, whiteSpace: "nowrap" }}>{h}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {approvedList.map((a, i) => (
                      <tr key={i} style={{ borderBottom: "1px solid #eee", background: i % 2 === 0 ? "#f9faf9" : "#fff" }}>
                        <td style={{ padding: "9px 12px", fontWeight: 600, color: "#2d1b10" }}>{a.member}</td>
                        <td style={{ padding: "9px 12px", fontFamily: "monospace", color: "#0277bd", fontSize: 11.5 }}>{a.txnId}</td>
                        <td style={{ padding: "9px 12px", fontWeight: 700, color: "#2e7d32" }}>{fmt(a.amount)}</td>
                        <td style={{ padding: "9px 12px", color: "#8b7355" }}>{fmt(a.previousLoan)}</td>
                        <td style={{ padding: "9px 12px", fontWeight: 700, color: "#2e7d32" }}>{fmt(a.newLoan)}</td>
                        <td style={{ padding: "9px 12px", color: "#8b7355", fontSize: 11.5 }}>{a.approvedAt}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}
        </div>
      )}

      {/* â”€â”€ TOAST â”€â”€ */}
      {toast && (
        <div style={{
          position:"fixed", bottom:30, left:"50%", transform:"translateX(-50%)",
          background:"linear-gradient(135deg,#2e7d32,#66bb6a)", color:"#fff",
          padding:"10px 24px", borderRadius:8, fontSize:13, fontWeight:600,
          boxShadow:"0 4px 16px rgba(46,125,50,.35)", zIndex:100, whiteSpace: "nowrap",
        }}>
          {toast}
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: MEETINGS (static, mirrors original)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MEETINGS = [
  {
    title: "Monthly General Meeting",
    date: "January 15, 2026 â€¢ 10:00 AM",
    badge: { label: "Completed", type: "success" },
    agenda: ["Review monthly savings contributions", "Discuss new loan applications", "Plan upcoming community event"],
    attendance: "18/20 members present (90%)",
    decisions: ["Approved loan of â‚¹40,000 for business expansion", "Decided to increase monthly savings target by â‚¹500", "Scheduled community health camp for Feb 10"],
  },
  {
    title: "Loan Review Meeting",
    date: "December 28, 2025 â€¢ 2:00 PM",
    badge: { label: "Completed", type: "success" },
    agenda: ["Review all active loans and EMI status", "Follow up on delayed payments", "Discuss loan policy updates"],
    attendance: "19/20 members present (95%)",
    decisions: ["Contacted members with delayed EMI payments", "Extended grace period for one member (medical)", "Updated loan interest rate policy"],
  },
  {
    title: "Financial Planning Workshop",
    date: "December 10, 2025 â€¢ 11:00 AM",
    badge: { label: "Workshop", type: "info" },
    agenda: ["Training on basic financial literacy", "Budgeting and savings strategies", "Understanding loan agreements"],
    attendance: "17/20 members present (85%)",
    decisions: ["Members gained financial planning understanding", "Created personal savings goals", "Discussed long-term group objectives"],
  },
];

function MeetingsPage() {
  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>Meeting Records</h1>
      <p style={{ color: "#5d4e37", marginBottom: 20 }}>Document and track SHG meetings</p>

      {MEETINGS.map((m, i) => (
        <div key={i} style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 16 }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 12 }}>
            <div>
              <h4 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 2 }}>{m.title}</h4>
              <span style={{ color: "#8b7355", fontSize: 12 }}>{m.date}</span>
            </div>
            <Badge type={m.badge.type}>{m.badge.label}</Badge>
          </div>
          <div style={{ marginBottom: 10 }}>
            <strong style={{ color: "#2d1b10", fontSize: 13 }}>Agenda:</strong>
            <ul style={{ paddingLeft: 18, color: "#5d4e37", fontSize: 12.5, marginTop: 4 }}>
              {m.agenda.map((a, j) => <li key={j}>{a}</li>)}
            </ul>
          </div>
          <p style={{ fontSize: 12.5, color: "#5d4e37", marginBottom: 8 }}>
            <strong style={{ color: "#2d1b10" }}>Attendance:</strong> {m.attendance}
          </p>
          <div>
            <strong style={{ color: "#2d1b10", fontSize: 13 }}>Key Decisions:</strong>
            <ul style={{ paddingLeft: 18, color: "#5d4e37", fontSize: 12.5, marginTop: 4 }}>
              {m.decisions.map((d, j) => <li key={j}>{d}</li>)}
            </ul>
          </div>
        </div>
      ))}

      <div style={{ display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 16, marginTop: 8 }}>
        <StatCard icon="ðŸ“…" value="3" label="Meetings This Quarter" />
        <StatCard icon="âœ“" value="90%" label="Avg Attendance" />
        <StatCard icon="ðŸ“‹" value="8" label="Decisions Made" />
        <StatCard icon="ðŸŽ¯" value="100%" label="Action Items Done" />
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: NOTIFICATIONS (dynamic from CSV)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function NotificationsPage({ selectedSHG, role, memberName }) {
  const members = useMemo(() => getMembersBySHG(selectedSHG), [selectedSHG]);
  const me = useMemo(() => members.find((m) => m.Name === memberName) || null, [members, memberName]);

  // Build notifications scoped by role
  const notifications = [];
  const source = role === "member" && me ? [me] : members;   // member sees only own; leader sees all

  source.filter((m) => m.EMIStatus === "Delayed").forEach((m) => {
    notifications.push({ icon: "âš ", iconType: "warning", title: "EMI Payment Reminder", text: role === "member" ? `Your EMI payment for loan ${fmt(m.LoanAmount)} is delayed. Please contact your leader.` : `${m.Name}'s EMI payment for loan ${fmt(m.LoanAmount)} is delayed. Please follow up.`, time: "Recent" });
  });
  source.filter((m) => m.LoanStatus === "Active" && m.EMIStatus === "On Time").forEach((m) => {
    notifications.push({ icon: "âœ“", iconType: "success", title: "Loan On Track", text: role === "member" ? `Your loan of ${fmt(m.LoanAmount)} â€” EMI is on time. Great job!` : `${m.Name}'s loan of ${fmt(m.LoanAmount)} â€” EMI is on time.`, time: "This month" });
  });
  source.filter((m) => m.Savings >= 20000).forEach((m) => {
    notifications.push({ icon: "ðŸ’°", iconType: "success", title: "Savings Milestone", text: role === "member" ? `Congratulations! You have crossed â‚¹20,000 in savings.` : `${m.Name} has crossed â‚¹20,000 in savings. Great progress!`, time: "Recent" });
  });
  if (role === "member" && me && me.LoanStatus === "Closed") {
    notifications.push({ icon: "ðŸŽ‰", iconType: "success", title: "Loan Completed", text: `You successfully completed your loan of ${fmt(me.LoanAmount)}.`, time: "Recent" });
  }
  notifications.push({ icon: "ðŸ“…", iconType: "info", title: "Upcoming Meeting", text: "Monthly general meeting scheduled for February 15, 2026 at 10:00 AM.", time: "2 days ago" });

  const iconBg = { warning: "rgba(245,124,0,.15)", info: "rgba(2,119,189,.15)", success: "rgba(46,125,50,.15)" };
  const iconCol = { warning: "#f57c00", info: "#0277bd", success: "#2e7d32" };

  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>{role === "member" ? "My Notifications" : "Notifications"}</h1>
      <p style={{ color: "#5d4e37", marginBottom: 20 }}>{role === "member" ? "Your personal alerts and reminders" : "Stay updated with important alerts and reminders"}</p>

      <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)" }}>
        <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 16, paddingBottom: 10, borderBottom: "2px solid #d4c5ad" }}>Recent Notifications</h3>
        {notifications.map((n, i) => (
          <div key={i} style={{ display: "flex", gap: 14, padding: "12px 0", borderBottom: i < notifications.length - 1 ? "1px solid #eee" : "none" }}>
            <div
              style={{
                width: 42,
                height: 42,
                borderRadius: "50%",
                background: iconBg[n.iconType],
                color: iconCol[n.iconType],
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                fontSize: 18,
                flexShrink: 0,
              }}
            >
              {n.icon}
            </div>
            <div>
              <div style={{ fontWeight: 600, color: "#2d1b10", fontSize: 13.5 }}>{n.title}</div>
              <div style={{ color: "#5d4e37", fontSize: 12.5, margin: "2px 0" }}>{n.text}</div>
              <div style={{ color: "#8b7355", fontSize: 11 }}>{n.time}</div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: REPORTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ReportsPage({ selectedSHG }) {
  const stats = useMemo(() => getSHGStats(selectedSHG), [selectedSHG]);
  const summaries = useMemo(() => getAllSHGSummaries(), []);
  const members = useMemo(() => getMembersBySHG(selectedSHG), [selectedSHG]);
  const avgSavings = Math.round(stats.totalSavings / stats.totalMembers);
  const onTimePct = stats.activeLoans > 0 ? Math.round((stats.onTimeEMI / stats.activeLoans) * 100) : 100;

  const roleBreakdown = {};
  members.forEach((m) => { roleBreakdown[m.Role] = (roleBreakdown[m.Role] || 0) + 1; });

  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>Reports & Analytics</h1>
      <p style={{ color: "#5d4e37", marginBottom: 20 }}>Comprehensive reports for all SHGs</p>

      {/* current SHG report */}
      <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 20 }}>
        <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 16, paddingBottom: 10, borderBottom: "2px solid #d4c5ad" }}>
          Current SHG Report: <span style={{ color: "#d84315" }}>{selectedSHG}</span>
        </h3>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(150px,1fr))", gap: 16, marginBottom: 20 }}>
          <StatCard icon="ðŸ‘¥" value={stats.totalMembers} label="Members" />
          <StatCard icon="ðŸ’°" value={fmt(stats.totalSavings)} label="Savings" />
          <StatCard icon="ðŸ“‹" value={stats.activeLoans} label="Active Loans" />
          <StatCard icon="ðŸ“Š" value={stats.avgAttendance + "%"} label="Attendance" />
        </div>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
          <div style={{ background: "#f5f1e8", borderRadius: 10, padding: 16 }}>
            <h4 style={{ fontSize: 14, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>Financial Metrics</h4>
            <div style={{ display: "flex", justifyContent: "space-between", padding: "6px 0", borderBottom: "1px solid #d4c5ad", fontSize: 13 }}>
              <span style={{ color: "#5d4e37" }}>Avg Savings / Member</span>
              <strong>{fmt(avgSavings)}</strong>
            </div>
            <div style={{ display: "flex", justifyContent: "space-between", padding: "6px 0", fontSize: 13 }}>
              <span style={{ color: "#5d4e37" }}>EMI On-Time Rate</span>
              <strong>{onTimePct}%</strong>
            </div>
          </div>
          <div style={{ background: "#f5f1e8", borderRadius: 10, padding: 16 }}>
            <h4 style={{ fontSize: 14, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>Role Breakdown</h4>
            {Object.entries(roleBreakdown).map(([role, count]) => (
              <div key={role} style={{ display: "flex", justifyContent: "space-between", padding: "6px 0", borderBottom: "1px solid #d4c5ad", fontSize: 13 }}>
                <span>{role}</span>
                <strong>{count}</strong>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* all SHGs comparison */}
      <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>All SHGs Comparison</h3>
      <DataTable
        headers={["SHG Name", "Members", "Savings", "Active Loans", "Attendance", "Health Score"]}
        rows={summaries.map((s) => {
          const hs = getHealthStatus(s.healthScore);
          return {
            cells: [
              <strong>{s.name}</strong>,
              s.totalMembers,
              <strong>{fmt(s.totalSavings)}</strong>,
              s.activeLoans,
              s.avgAttendance + "%",
              <span style={{ display: "flex", alignItems: "center", gap: 6 }}>
                <strong>{s.healthScore}</strong> <Badge type={hs.cls}>{hs.status}</Badge>
              </span>,
            ],
          };
        })}
      />
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: INSIGHTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function InsightsPage({ selectedSHG }) {
  const healthScore = useMemo(() => calculateHealthScore(selectedSHG), [selectedSHG]);
  const healthStatus = getHealthStatus(healthScore);
  const stats = useMemo(() => getSHGStats(selectedSHG), [selectedSHG]);
  const summaries = useMemo(() => getAllSHGSummaries(), []);
  const sorted = [...summaries].sort((a, b) => b.healthScore - a.healthScore);

  const emiComp = stats.activeLoans > 0 ? Math.round((stats.onTimeEMI / stats.activeLoans) * 100) : 100;

  // risk
  const risky = summaries.filter((s) => s.healthScore < 80);
  // recommendations
  const recs = [];
  if (stats.avgAttendance < 90) recs.push({ icon: "ðŸ“Š", title: "Improve Attendance", text: `Current: ${stats.avgAttendance}%. Consider convenient meeting times or incentives.`, priority: "warning" });
  if (stats.delayedEMI > 0) recs.push({ icon: "âš ", title: "Address Delayed EMIs", text: `${stats.delayedEMI} member(s) delayed. Follow up or consider restructuring.`, priority: "danger" });
  const avgSav = stats.totalSavings / stats.totalMembers;
  if (avgSav < 15000) recs.push({ icon: "ðŸ’°", title: "Increase Savings", text: `Avg savings: ${fmt(Math.round(avgSav))}. Encourage higher contributions.`, priority: "info" });
  if (stats.avgAttendance >= 90 && stats.delayedEMI === 0) recs.push({ icon: "ðŸŽ‰", title: "Excellent Performance!", text: "Your SHG is doing exceptionally well. Share best practices with others.", priority: "success" });

  function calcEMIRate(shg) {
    const active = getMembersBySHG(shg).filter((m) => m.LoanStatus === "Active");
    if (!active.length) return "N/A";
    return Math.round((active.filter((m) => m.EMIStatus === "On Time").length / active.length) * 100) + "%";
  }

  return (
    <div>
      <h1 style={{ fontSize: 24, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>Insights & Health Scores</h1>
      <p style={{ color: "#5d4e37", marginBottom: 20 }}>Analysis of SHG performance and health</p>

      {/* health score card */}
      <div style={{ background: "#fff", borderRadius: 12, padding: 28, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 20, textAlign: "center" }}>
        <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 16, paddingBottom: 10, borderBottom: "2px solid #d4c5ad" }}>Your SHG Health Score</h3>
        <div style={{ fontSize: 56, fontWeight: 700, color: "#d84315", lineHeight: 1 }}>{healthScore}</div>
        <div style={{ marginTop: 8, marginBottom: 16 }}>
          <Badge type={healthStatus.cls}>{healthStatus.status}</Badge>
        </div>
        <div style={{ maxWidth: 360, margin: "0 auto 16px", height: 18, background: "#d4c5ad", borderRadius: 9, overflow: "hidden" }}>
          <div style={{ height: "100%", width: `${healthScore}%`, background: "linear-gradient(90deg,#00897b,#4db6ac)", borderRadius: 9, transition: "width .5s" }} />
        </div>
        <p style={{ color: "#8b7355", fontSize: 12, marginBottom: 16 }}>Health Score = (Avg Attendance + % On-Time EMI) / 2</p>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, maxWidth: 360, margin: "0 auto" }}>
          {[
            { label: "Attendance Rate", value: stats.avgAttendance + "%" },
            { label: "On-Time EMI %", value: emiComp + "%" },
          ].map((item) => (
            <div key={item.label} style={{ background: "#f5f1e8", borderRadius: 10, padding: 14 }}>
              <div style={{ fontSize: 22, fontWeight: 700, color: "#00897b" }}>{item.value}</div>
              <div style={{ color: "#5d4e37", fontSize: 12, marginTop: 4 }}>{item.label}</div>
            </div>
          ))}
        </div>
      </div>

      {/* ranking table */}
      <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>All SHGs Health Ranking</h3>
      <DataTable
        headers={["Rank", "SHG Name", "Health Score", "Attendance", "On-Time EMI", "Status"]}
        rows={sorted.map((s, i) => {
          const hs = getHealthStatus(s.healthScore);
          return {
            _highlight: s.name === selectedSHG ? "rgba(216,67,21,.05)" : undefined,
            cells: [
              <strong>{i + 1}</strong>,
              <span>
                <strong>{s.name}</strong> {s.name === selectedSHG && <Badge type="info">Current</Badge>}
              </span>,
              <span style={{ display: "flex", alignItems: "center", gap: 6 }}>
                <ProgressBar value={s.healthScore} maxW={100} /> <strong>{s.healthScore}</strong>
              </span>,
              s.avgAttendance + "%",
              calcEMIRate(s.name),
              <Badge type={hs.cls}>{hs.status}</Badge>,
            ],
          };
        })}
      />

      {/* risk */}
      <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginTop: 24, marginBottom: 10 }}>Risk Analysis</h3>
      <div style={{ background: "#fff", borderRadius: 12, padding: 20, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", marginBottom: 20 }}>
        {risky.length === 0 ? (
          <div style={{ padding: "10px 14px", borderRadius: 8, borderLeft: "4px solid #2e7d32", background: "rgba(46,125,50,.06)", color: "#2e7d32", fontSize: 13 }}>
            âœ“ <strong>Excellent!</strong> All SHGs are performing well (health score â‰¥ 80).
          </div>
        ) : (
          <>
            <div style={{ padding: "10px 14px", borderRadius: 8, borderLeft: "4px solid #f57c00", background: "rgba(245,124,0,.06)", color: "#f57c00", fontSize: 13, marginBottom: 12 }}>
              âš  <strong>{risky.length} SHG(s)</strong> have health scores below 80.
            </div>
            {risky.map((s) => (
              <div key={s.name} style={{ background: "#f5f1e8", borderRadius: 10, padding: 14, marginBottom: 8 }}>
                <strong style={{ color: "#2d1b10" }}>{s.name}</strong> â€” Health: <strong>{s.healthScore}</strong>
                <span style={{ marginLeft: 8 }}>
                  <Badge type="warning">Needs Attention</Badge>
                </span>
              </div>
            ))}
          </>
        )}
      </div>

      {/* recommendations */}
      <h3 style={{ fontSize: 16, fontWeight: 700, color: "#2d1b10", marginBottom: 10 }}>Recommendations</h3>
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {recs.map((r, i) => (
          <div key={i} style={{ background: "#fff", borderRadius: 12, padding: 18, border: "1px solid #d4c5ad", boxShadow: "0 2px 8px rgba(45,27,16,.08)", display: "flex", gap: 14 }}>
            <span style={{ fontSize: 28 }}>{r.icon}</span>
            <div style={{ flex: 1 }}>
              <h4 style={{ fontSize: 15, fontWeight: 700, color: "#2d1b10", marginBottom: 4 }}>{r.title}</h4>
              <p style={{ fontSize: 12.5, color: "#5d4e37", marginBottom: 6 }}>{r.text}</p>
              <Badge type={r.priority}>{r.priority === "success" ? "Success" : r.priority.toUpperCase() + " PRIORITY"}</Badge>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: LANDING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LandingPage({ onGetStarted }) {
  const features = [
    { icon: "ðŸ‘¥", title: "Member Management", text: "Track all member details, roles, and participation in one centralized system." },
    { icon: "ðŸ’°", title: "Savings Tracking", text: "Monitor individual and group savings with real-time updates and reports." },
    { icon: "ðŸ“‹", title: "Loan Management", text: "Track loan applications, EMI payments, and identify delays instantly." },
    { icon: "ðŸ“Š", title: "Reports & Insights", text: "Generate comprehensive reports and health scores to measure performance." },
    { icon: "ðŸ“…", title: "Meeting Records", text: "Document meeting agendas, attendance, and decisions for full transparency." },
    { icon: "ðŸ””", title: "Notifications", text: "Stay informed with alerts for EMI due dates, meetings, and updates." },
  ];
  const problems = [
    { icon: "ðŸ“Š", title: "Manual Record Keeping", text: "Paper records lead to errors and lost information." },
    { icon: "ðŸ’°", title: "Loan Tracking Issues", text: "Difficult to monitor EMI payments and identify defaulters." },
    { icon: "ðŸ“‰", title: "Low Transparency", text: "Members lack clear visibility into group finances." },
    { icon: "â°", title: "Attendance Management", text: "Hard to track meeting participation and engagement." },
  ];
  return (
    <div style={{ fontFamily: "'Poppins', sans-serif", background: "#fdfbf7", minHeight: "100vh" }}>
      {/* hero */}
      <section
        style={{
          minHeight: "100vh",
          display: "flex",
          alignItems: "center",
          background: "linear-gradient(135deg,rgba(216,67,21,.06),rgba(255,167,38,.06))",
          position: "relative",
          overflow: "hidden",
        }}
      >
        <div style={{ position: "absolute", top: "-40%", right: "-15%", width: "70%", height: "180%", background: "radial-gradient(circle,rgba(216,67,21,.08) 0%,transparent 70%)", pointerEvents: "none" }} />
        <div style={{ maxWidth: 1200, margin: "0 auto", padding: "0 32px", position: "relative", zIndex: 1 }}>
          <div
            style={{
              display: "inline-block",
              background: "linear-gradient(135deg,#d84315,#ffa726)",
              color: "#fff",
              padding: "6px 20px",
              borderRadius: 30,
              fontSize: 14,
              fontWeight: 600,
              marginBottom: 20,
              boxShadow: "0 4px 12px rgba(216,67,21,.3)",
            }}
          >
            ðŸŒŸ Hackathon Project 2026
          </div>
          <h1
            style={{
              fontSize: 56,
              fontWeight: 700,
              lineHeight: 1.15,
              marginBottom: 20,
              background: "linear-gradient(135deg,#d84315,#ffa726)",
              WebkitBackgroundClip: "text",
              WebkitTextFillColor: "transparent",
            }}
          >
            Strength in Numbers
          </h1>
          <p style={{ fontSize: 19, color: "#5d4e37", maxWidth: 580, marginBottom: 32, lineHeight: 1.6 }}>
            Empowering Women's Self-Help Groups through digital transformation. Manage savings, track loans, and build stronger communities together.
          </p>
          <div style={{ display: "flex", gap: 16 }}>
            <button
              onClick={onGetStarted}
              style={{
                padding: "12px 28px",
                background: "linear-gradient(135deg,#d84315,#ff7043)",
                color: "#fff",
                border: "none",
                borderRadius: 8,
                fontSize: 16,
                fontWeight: 600,
                cursor: "pointer",
                boxShadow: "0 4px 12px rgba(216,67,21,.3)",
                fontFamily: "inherit",
              }}
            >
              Get Started
            </button>
            <button
              style={{
                padding: "12px 28px",
                background: "transparent",
                color: "#d84315",
                border: "2px solid #d84315",
                borderRadius: 8,
                fontSize: 16,
                fontWeight: 600,
                cursor: "pointer",
                fontFamily: "inherit",
              }}
            >
              Learn More
            </button>
          </div>
        </div>
      </section>

      {/* problems */}
      <section style={{ padding: "80px 32px", background: "#fff" }}>
        <div style={{ maxWidth: 800, margin: "0 auto", textAlign: "center" }}>
          <h2 style={{ fontSize: 36, fontWeight: 700, color: "#2d1b10", marginBottom: 12 }}>The Challenge</h2>
          <p style={{ color: "#5d4e37", fontSize: 17, marginBottom: 40, maxWidth: 580, margin: "0 auto 40px" }}>
            Women's SHGs face significant barriers in managing financial operations. Traditional paper-based systems are inefficient and error-prone.
          </p>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(180px,1fr))", gap: 16, textAlign: "left" }}>
            {problems.map((p, i) => (
              <div key={i} style={{ background: "#f5f1e8", padding: 18, borderRadius: 10, borderLeft: "4px solid #d84315" }}>
                <h4 style={{ color: "#d84315", fontSize: 14, marginBottom: 6 }}>
                  {p.icon} {p.title}
                </h4>
                <p style={{ color: "#5d4e37", fontSize: 13 }}>{p.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* features */}
      <section style={{ padding: "80px 32px", background: "#f5f1e8" }}>
        <div style={{ maxWidth: 1200, margin: "0 auto" }}>
          <h2 style={{ fontSize: 36, fontWeight: 700, color: "#2d1b10", textAlign: "center", marginBottom: 12 }}>Our Solution</h2>
          <p style={{ color: "#5d4e37", fontSize: 17, textAlign: "center", maxWidth: 580, margin: "0 auto 40px" }}>
            A comprehensive digital platform designed specifically for Women's SHGs.
          </p>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(280px,1fr))", gap: 20 }}>
            {features.map((f, i) => (
              <div
                key={i}
                style={{
                  background: "#fff",
                  padding: 24,
                  borderRadius: 12,
                  border: "1px solid #d4c5ad",
                  boxShadow: "0 2px 8px rgba(45,27,16,.08)",
                  transition: "transform .2s, box-shadow .2s",
                }}
              >
                <div
                  style={{
                    width: 52,
                    height: 52,
                    borderRadius: 12,
                    background: "linear-gradient(135deg,#ff7043,#ffa726)",
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "center",
                    fontSize: 24,
                    marginBottom: 14,
                  }}
                >
                  {f.icon}
                </div>
                <h3 style={{ fontSize: 17, fontWeight: 700, color: "#2d1b10", marginBottom: 6 }}>{f.title}</h3>
                <p style={{ color: "#5d4e37", fontSize: 13, lineHeight: 1.5 }}>{f.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* CTA */}
      <section style={{ padding: "80px 32px", background: "linear-gradient(135deg,rgba(216,67,21,.06),rgba(255,167,38,.06))", textAlign: "center" }}>
        <h2 style={{ fontSize: 36, fontWeight: 700, color: "#2d1b10", marginBottom: 12 }}>Ready to Transform Your SHG?</h2>
        <p style={{ color: "#5d4e37", fontSize: 17, maxWidth: 560, margin: "0 auto 28px" }}>
          Join the digital revolution and empower your community with better financial management.
        </p>
        <button
          onClick={onGetStarted}
          style={{
            padding: "12px 32px",
            background: "linear-gradient(135deg,#d84315,#ff7043)",
            color: "#fff",
            border: "none",
            borderRadius: 8,
            fontSize: 16,
            fontWeight: 600,
            cursor: "pointer",
            boxShadow: "0 4px 12px rgba(216,67,21,.3)",
            fontFamily: "inherit",
          }}
        >
          Start Your Journey
        </button>
      </section>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: LOGIN
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LoginPage({ onLogin, onBack }) {
  const [role, setRole] = useState(null);
  return (
    <div style={{ minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center", background: "linear-gradient(135deg,rgba(216,67,21,.06),rgba(255,167,38,.06))", fontFamily: "'Poppins', sans-serif" }}>
      <div style={{ background: "#fff", padding: 40, borderRadius: 16, boxShadow: "0 8px 32px rgba(45,27,16,.15)", width: "100%", maxWidth: 440, border: "1px solid #d4c5ad" }}>
        <div style={{ textAlign: "center", marginBottom: 24 }}>
          <div style={{ fontSize: 36, marginBottom: 10, background: "linear-gradient(135deg,#d84315,#ffa726)", WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent" }}>â—†</div>
          <h1 style={{ fontSize: 26, fontWeight: 700, color: "#2d1b10", marginBottom: 6 }}>Welcome Back</h1>
          <p style={{ color: "#5d4e37" }}>Select your role to continue</p>
        </div>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 12, marginBottom: 24 }}>
          {[{ key: "member", icon: "ðŸ‘¤", label: "Member" }, { key: "leader", icon: "â­", label: "SHG Leader" }, { key: "superadmin", icon: "ðŸ›¡ï¸", label: "Super Admin" }].map((r) => (
            <button key={r.key} onClick={() => setRole(r.key)} style={{ padding: "20px 12px", border: role === r.key ? "2px solid #d84315" : "2px solid #d4c5ad", borderRadius: 12, background: role === r.key ? "linear-gradient(135deg,rgba(216,67,21,.1),rgba(255,167,38,.1))" : "#fff", boxShadow: role === r.key ? "0 4px 12px rgba(216,67,21,.2)" : "none", cursor: "pointer", fontFamily: "inherit", transition: "all .2s" }}>
              <div style={{ fontSize: 28, marginBottom: 6 }}>{r.icon}</div>
              <div style={{ fontWeight: 600, fontSize: 14, color: "#2d1b10" }}>{r.label}</div>
            </button>
          ))}
        </div>
        <div style={{ marginBottom: 16 }}>
          <label style={{ display: "block", fontWeight: 600, fontSize: 13, color: "#2d1b10", marginBottom: 6 }}>Username</label>
          <input type="text" placeholder="Enter your username" style={{ width: "100%", padding: "10px 14px", border: "2px solid #d4c5ad", borderRadius: 8, fontSize: 14, fontFamily: "inherit", boxSizing: "border-box" }} />
        </div>
        <div style={{ marginBottom: 24 }}>
          <label style={{ display: "block", fontWeight: 600, fontSize: 13, color: "#2d1b10", marginBottom: 6 }}>Password</label>
          <input type="password" placeholder="Enter your password" style={{ width: "100%", padding: "10px 14px", border: "2px solid #d4c5ad", borderRadius: 8, fontSize: 14, fontFamily: "inherit", boxSizing: "border-box" }} />
        </div>
        <button onClick={() => { if (role) onLogin(role); }} style={{ width: "100%", padding: "12px", background: role ? "linear-gradient(135deg,#d84315,#ff7043)" : "#ccc", color: "#fff", border: "none", borderRadius: 8, fontSize: 16, fontWeight: 600, cursor: role ? "pointer" : "not-allowed", boxShadow: role ? "0 4px 12px rgba(216,67,21,.3)" : "none", fontFamily: "inherit", transition: "all .2s" }}>
          Login
        </button>
        {!role && <p style={{ textAlign: "center", fontSize: 12, color: "#c62828", marginTop: 8 }}>Please select a role first</p>}
        <div style={{ textAlign: "center", marginTop: 18 }}>
          <button onClick={onBack} style={{ background: "none", border: "none", color: "#5d4e37", fontSize: 13, cursor: "pointer", fontFamily: "inherit" }}>â† Back to Home</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: SHG SELECT  (leader picks SHG; member picks SHG then picks themselves)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SHGSelectPage({ role, onSelect, onBack }) {
  const [chosenSHG, setChosenSHG]       = useState(null);
  const [chosenMember, setChosenMember] = useState(null);
  const [step, setStep]                 = useState(1); // 1 = pick SHG, 2 = pick member (member-role only)
  const shgs = useMemo(() => getAllSHGs(), []);

  const shgMembers = useMemo(() => chosenSHG ? getMembersBySHG(chosenSHG) : [], [chosenSHG]);

  function handleContinue() {
    if (role === "leader") {
      onSelect(chosenSHG, null);          // leader: no member identity needed
    } else {
      // member: first go to step 2
      if (step === 1) { setStep(2); setChosenMember(null); return; }
      onSelect(chosenSHG, chosenMember);  // member: pass both SHG + member name
    }
  }

  const canContinue = step === 1 ? !!chosenSHG : !!chosenMember;

  return (
    <div
      style={{
        minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center",
        background: "linear-gradient(135deg,rgba(216,67,21,.06),rgba(255,167,38,.06))",
        fontFamily: "'Poppins', sans-serif",
      }}
    >
      <div style={{ background: "#fff", padding: 40, borderRadius: 16, boxShadow: "0 8px 32px rgba(45,27,16,.15)", width: "100%", maxWidth: 500, border: "1px solid #d4c5ad" }}>
        <div style={{ textAlign: "center", marginBottom: 24 }}>
          <div style={{ fontSize: 36, marginBottom: 10, background: "linear-gradient(135deg,#d84315,#ffa726)", WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent" }}>â—†</div>
          {step === 1 ? (
            <>
              <h1 style={{ fontSize: 26, fontWeight: 700, color: "#2d1b10", marginBottom: 6 }}>Select Your SHG</h1>
              <p style={{ color: "#5d4e37" }}>Choose a Self-Help Group {role === "member" ? "you belong to" : "to manage"}</p>
            </>
          ) : (
            <>
              <h1 style={{ fontSize: 26, fontWeight: 700, color: "#2d1b10", marginBottom: 6 }}>Select Your Profile</h1>
              <p style={{ color: "#5d4e37" }}>Choose your name from <strong>{chosenSHG}</strong></p>
            </>
          )}
        </div>

        {/* step indicator */}
        {role === "member" && (
          <div style={{ display: "flex", justifyContent: "center", gap: 8, marginBottom: 20 }}>
            {[1, 2].map((s) => (
              <div key={s} style={{ display: "flex", alignItems: "center", gap: 6 }}>
                <div style={{
                  width: 28, height: 28, borderRadius: "50%", display: "flex", alignItems: "center", justifyContent: "center",
                  fontSize: 13, fontWeight: 700,
                  background: step >= s ? "linear-gradient(135deg,#d84315,#ff7043)" : "#d4c5ad",
                  color: step >= s ? "#fff" : "#fff",
                }}>
                  {s}
                </div>
                <span style={{ fontSize: 12, color: step >= s ? "#d84315" : "#8b7355", fontWeight: 600 }}>
                  {s === 1 ? "Select SHG" : "Select Profile"}
                </span>
                {s < 2 && <span style={{ color: "#d4c5ad", margin: "0 4px" }}>â†’</span>}
              </div>
            ))}
          </div>
        )}

        {/* STEP 1: SHG list */}
        {step === 1 && (
          <div style={{ display: "flex", flexDirection: "column", gap: 10, marginBottom: 24 }}>
            {shgs.map((name) => {
              const st = getSHGStats(name);
              const active = chosenSHG === name;
              return (
                <button
                  key={name}
                  onClick={() => setChosenSHG(name)}
                  style={{
                    padding: "16px 18px",
                    border: active ? "2px solid #d84315" : "2px solid #d4c5ad",
                    borderRadius: 12,
                    background: active ? "linear-gradient(135deg,rgba(216,67,21,.1),rgba(255,167,38,.1))" : "#fff",
                    boxShadow: active ? "0 4px 12px rgba(216,67,21,.2)" : "none",
                    cursor: "pointer", textAlign: "left", fontFamily: "inherit", transition: "all .2s",
                  }}
                >
                  <div style={{ fontWeight: 600, fontSize: 15, color: "#2d1b10" }}>{name}</div>
                  <div style={{ color: "#5d4e37", fontSize: 13, marginTop: 2 }}>
                    {st.totalMembers} members Â· {fmt(st.totalSavings)} savings
                  </div>
                </button>
              );
            })}
          </div>
        )}

        {/* STEP 2: member picker (member-role only) */}
        {step === 2 && (
          <div style={{ display: "flex", flexDirection: "column", gap: 8, marginBottom: 24, maxHeight: 280, overflowY: "auto", paddingRight: 4 }}>
            {shgMembers.map((m) => {
              const active = chosenMember === m.Name;
              return (
                <button
                  key={m.MemberID}
                  onClick={() => setChosenMember(m.Name)}
                  style={{
                    padding: "12px 16px", display: "flex", alignItems: "center", gap: 14,
                    border: active ? "2px solid #d84315" : "2px solid #d4c5ad",
                    borderRadius: 12,
                    background: active ? "linear-gradient(135deg,rgba(216,67,21,.1),rgba(255,167,38,.1))" : "#fff",
                    boxShadow: active ? "0 4px 12px rgba(216,67,21,.2)" : "none",
                    cursor: "pointer", textAlign: "left", fontFamily: "inherit", transition: "all .2s",
                  }}
                >
                  <div style={{
                    width: 38, height: 38, borderRadius: "50%", flexShrink: 0,
                    background: "linear-gradient(135deg,#d84315,#ffa726)",
                    display: "flex", alignItems: "center", justifyContent: "center",
                    color: "#fff", fontWeight: 700, fontSize: 16,
                  }}>
                    {m.Name[0]}
                  </div>
                  <div>
                    <div style={{ fontWeight: 600, fontSize: 14, color: "#2d1b10" }}>{m.Name}</div>
                    <div style={{ fontSize: 12, color: "#5d4e37" }}>{m.Role} Â· Age {m.Age}</div>
                  </div>
                </button>
              );
            })}
          </div>
        )}

        {/* continue button */}
        {canContinue && (
          <button
            onClick={handleContinue}
            style={{
              width: "100%", padding: "12px",
              background: "linear-gradient(135deg,#d84315,#ff7043)", color: "#fff",
              border: "none", borderRadius: 8, fontSize: 16, fontWeight: 600,
              cursor: "pointer", boxShadow: "0 4px 12px rgba(216,67,21,.3)", fontFamily: "inherit",
            }}
          >
            {step === 1 && role === "member" ? "Continue â†’" : "Continue to Dashboard"}
          </button>
        )}
        

        {/* back links */}
        <div style={{ textAlign: "center", marginTop: 18 }}>
          {step === 2 ? (
            <button onClick={() => { setStep(1); setChosenMember(null); }} style={{ background: "none", border: "none", color: "#5d4e37", fontSize: 13, cursor: "pointer", fontFamily: "inherit" }}>
              â† Back to SHG selection
            </button>
          ) : (
            <button onClick={onBack} style={{ background: "none", border: "none", color: "#5d4e37", fontSize: 13, cursor: "pointer", fontFamily: "inherit" }}>
              â† Back to Login
            </button>
          )}
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: NGO LOCATOR  (leader only)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function NGOLocatorPage() {
  const [search, setSearch]       = useState("");
  const [sortNearest, setSortNearest] = useState(true);
  const [toast, setToast]         = useState(null);

  const filtered = useMemo(() => {
    let list = NGOS.filter(n =>
      n.name.toLowerCase().includes(search.toLowerCase()) ||
      n.city.toLowerCase().includes(search.toLowerCase()) ||
      n.focus.toLowerCase().includes(search.toLowerCase())
    );
    return sortNearest ? [...list].sort((a,b) => a.dist - b.dist) : list;
  }, [search, sortNearest]);

  function copyVal(text, label) {
    navigator.clipboard.writeText(text).catch(()=>{});
    setToast(label + " copied!");
    setTimeout(() => setToast(null), 1800);
  }

  return (
    <div>
      <h1 style={{ fontSize:24, fontWeight:700, color:"#2d1b10", marginBottom:4 }}>NGO Locator</h1>
      <p style={{ color:"#5d4e37", marginBottom:20 }}>Find nearby NGO partners and grab their contact details.</p>

      {/* search + sort row */}
      <div style={{ display:"flex", gap:10, marginBottom:20 }}>
        <input
          placeholder="Search by name, city, or focusâ€¦"
          value={search}
          onChange={e => setSearch(e.target.value)}
          style={{
            flex:1, padding:"10px 14px", border:"2px solid #d4c5ad", borderRadius:8,
            fontSize:14, fontFamily:"inherit", outline:"none", background:"#fff",
          }}
          onFocus={e => e.target.style.borderColor="#d84315"}
          onBlur={e => e.target.style.borderColor="#d4c5ad"}
        />
        <button
          onClick={() => setSortNearest(!sortNearest)}
          style={{
            padding:"10px 16px", border: sortNearest ? "2px solid #d84315" : "2px solid #d4c5ad",
            borderRadius:8, background: sortNearest ? "linear-gradient(135deg,rgba(216,67,21,.1),rgba(255,167,38,.1))" : "#fff",
            color: sortNearest ? "#d84315" : "#5d4e37", fontWeight:600, fontSize:13,
            cursor:"pointer", fontFamily:"inherit", whiteSpace:"nowrap", transition:"all .2s",
          }}
        >
          ðŸ“ {sortNearest ? "Nearest First" : "Default Order"}
        </button>
      </div>

      {/* summary strip */}
      <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:16, marginBottom:24 }}>
        <StatCard icon="ðŸ¢" value={NGOS.length}                                       label="Total NGO Partners" />
        <StatCard icon="ðŸ“" value={filtered.length > 0 ? filtered[0].dist+" km" : "â€”"} label="Nearest NGO"         gradientColor="#00897b" />
        <StatCard icon="ðŸ“ž" value="Ready"                                             label="Contact Available"  gradientColor="#00897b" />
      </div>

      {/* grid */}
      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:16 }}>
        {filtered.map(ngo => (
          <div key={ngo.id} style={{
            background:"#fff", border:"1px solid #d4c5ad", borderRadius:12,
            padding:20, boxShadow:"0 2px 8px rgba(45,27,16,.08)", transition:"all .2s",
          }}>
            {/* header row */}
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:10 }}>
              <h4 style={{ fontSize:15, fontWeight:700, color:"#2d1b10", margin:0 }}>{ngo.name}</h4>
              <span style={{
                fontSize:11, fontWeight:700, color:"#fff", background:"linear-gradient(135deg,#00897b,#4db6ac)",
                padding:"3px 9px", borderRadius:20, whiteSpace:"nowrap",
              }}>
                {ngo.dist} km
              </span>
            </div>
            {/* focus tag */}
            <div style={{ fontSize:12, color:"#d84315", fontWeight:600, marginBottom:6 }}>ðŸŽ¯ {ngo.focus}</div>
            {/* address */}
            <div style={{ fontSize:12, color:"#8b7355", marginBottom:14 }}>ðŸ“Œ {ngo.addr}, {ngo.city}, {ngo.state}</div>
            {/* contact buttons */}
            <div style={{ display:"flex", gap:8 }}>
              <button
                onClick={() => copyVal(ngo.phone, "Phone")}
                style={{
                  flex:1, display:"flex", alignItems:"center", gap:6, padding:"8px 10px",
                  border:"2px solid #d4c5ad", borderRadius:8, background:"transparent",
                  color:"#5d4e37", fontSize:12, fontWeight:600, cursor:"pointer",
                  fontFamily:"inherit", transition:"all .2s",
                }}
                onMouseEnter={e => { e.currentTarget.style.borderColor="#d84315"; e.currentTarget.style.color="#d84315"; e.currentTarget.style.background="rgba(216,67,21,.06)"; }}
                onMouseLeave={e => { e.currentTarget.style.borderColor="#d4c5ad"; e.currentTarget.style.color="#5d4e37"; e.currentTarget.style.background="transparent"; }}
              >
                ðŸ“ž {ngo.phone}
              </button>
              <button
                onClick={() => copyVal(ngo.email, "Email")}
                style={{
                  flex:1, display:"flex", alignItems:"center", gap:6, padding:"8px 10px",
                  border:"2px solid #d4c5ad", borderRadius:8, background:"transparent",
                  color:"#5d4e37", fontSize:11.5, fontWeight:600, cursor:"pointer",
                  fontFamily:"inherit", transition:"all .2s", wordBreak:"break-all",
                }}
                onMouseEnter={e => { e.currentTarget.style.borderColor="#00897b"; e.currentTarget.style.color="#00897b"; e.currentTarget.style.background="rgba(0,137,123,.06)"; }}
                onMouseLeave={e => { e.currentTarget.style.borderColor="#d4c5ad"; e.currentTarget.style.color="#5d4e37"; e.currentTarget.style.background="transparent"; }}
              >
                âœ‰ {ngo.email}
              </button>
            </div>
          </div>
        ))}
        {filtered.length === 0 && (
          <div style={{ gridColumn:"1 / -1", textAlign:"center", padding:40, color:"#8b7355", fontSize:14 }}>
            No NGOs match your search. Try a different keyword.
          </div>
        )}
      </div>

      {/* copy toast */}
      {toast && (
        <div style={{
          position:"fixed", bottom:30, left:"50%", transform:"translateX(-50%)",
          background:"linear-gradient(135deg,#d84315,#ff7043)", color:"#fff",
          padding:"10px 24px", borderRadius:8, fontSize:13, fontWeight:600,
          boxShadow:"0 4px 16px rgba(216,67,21,.35)", zIndex:100,
        }}>
          âœ“ {toast}
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: TRAINING PROGRESS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function TrainingPage({ selectedSHG, role, memberName }) {
  const members = useMemo(() => getMembersBySHG(selectedSHG), [selectedSHG]);
  // leader sees all members; member sees only self
  const viewMembers = role === "member" && memberName
    ? members.filter(m => m.Name === memberName)
    : members;

  const [selected, setSelected] = useState(viewMembers[0]?.Name || null);
  // keep selection valid when SHG switches
  const activeName = viewMembers.find(m => m.Name === selected) ? selected : (viewMembers[0]?.Name || null);

  const training = useMemo(() => activeName ? getTrainingForMember(activeName) : [], [activeName]);
  const totalLessons   = training.reduce((s,t) => s + t.totalLessons, 0);
  const doneLessons    = training.reduce((s,t) => s + t.completed, 0);
  const doneModules    = training.filter(t => t.status === "done").length;
  const overallPct     = totalLessons > 0 ? Math.round((doneLessons / totalLessons) * 100) : 0;

  function statusStyle(status) {
    if (status === "done")        return { bg:"rgba(46,125,50,.12)",  color:"#2e7d32", icon:"âœ“" };
    if (status === "in-progress") return { bg:"rgba(245,124,0,.12)",  color:"#f57c00", icon:"â—" };
    return                               { bg:"rgba(0,0,0,.06)",      color:"#8b7355", icon:"ðŸ”’" };
  }

  return (
    <div>
      <h1 style={{ fontSize:24, fontWeight:700, color:"#2d1b10", marginBottom:4 }}>Training Progress</h1>
      <p style={{ color:"#5d4e37", marginBottom:20 }}>
        {role === "member" ? "Your training modules and lesson completion." : "View every member's training status."}
      </p>

      {/* member tabs (leader only) */}
      {role === "leader" && (
        <div style={{ display:"flex", gap:6, flexWrap:"wrap", marginBottom:22 }}>
          {viewMembers.map(m => {
            const active = activeName === m.Name;
            return (
              <button key={m.Name} onClick={() => setSelected(m.Name)} style={{
                display:"flex", alignItems:"center", gap:8, padding:"7px 14px", borderRadius:22,
                border: active ? "2px solid #d84315" : "2px solid #d4c5ad",
                background: active ? "linear-gradient(135deg,rgba(216,67,21,.1),rgba(255,167,38,.1))" : "#fff",
                color: active ? "#d84315" : "#5d4e37",
                fontSize:12.5, fontWeight:600, cursor:"pointer", fontFamily:"inherit", transition:"all .2s",
              }}>
                <span style={{
                  width:26, height:26, borderRadius:"50%", display:"flex", alignItems:"center", justifyContent:"center",
                  background:"linear-gradient(135deg,#d84315,#ffa726)", color:"#fff", fontSize:10, fontWeight:700,
                }}>{m.Name[0]}</span>
                {m.Name}
              </button>
            );
          })}
        </div>
      )}

      {/* summary cards */}
      <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:16, marginBottom:24 }}>
        <StatCard icon="ðŸ“Š" value={overallPct + "%"}                       label="Overall Progress" />
        <StatCard icon="ðŸ“š" value={doneModules + "/" + training.length}    label="Modules Done"     gradientColor="#00897b" />
        <StatCard icon="âœ“"  value={doneLessons + "/" + totalLessons}       label="Lessons Done"     gradientColor="#00897b" />
      </div>

      {/* overall progress bar */}
      <div style={{ background:"#fff", borderRadius:12, padding:18, border:"1px solid #d4c5ad", boxShadow:"0 2px 8px rgba(45,27,16,.08)", marginBottom:20, display:"flex", alignItems:"center", gap:16 }}>
        <span style={{ fontSize:13, fontWeight:600, color:"#2d1b10", minWidth:80 }}>{activeName}</span>
        <div style={{ flex:1 }}><ProgressBar value={overallPct} maxW="100%" /></div>
        <span style={{ fontSize:15, fontWeight:700, color:"#d84315" }}>{overallPct}%</span>
        <Badge type={overallPct >= 75 ? "success" : overallPct >= 40 ? "warning" : "danger"}>
          {overallPct >= 75 ? "On Track" : overallPct >= 40 ? "In Progress" : "Just Started"}
        </Badge>
      </div>

      {/* module list */}
      <div style={{ display:"flex", flexDirection:"column", gap:10 }}>
        {training.map((t, idx) => {
          const s     = statusStyle(t.status);
          const pct   = t.totalLessons > 0 ? Math.round((t.completed / t.totalLessons) * 100) : 0;
          const locked = t.status === "locked";
          return (
            <div key={t.id} style={{
              background: t.status === "done" ? "rgba(46,125,50,.04)" : "#fff",
              border: t.status === "done" ? "1px solid rgba(46,125,50,.25)" : "1px solid #d4c5ad",
              borderRadius:12, padding:"16px 20px", display:"flex", alignItems:"center", gap:16,
              boxShadow:"0 2px 8px rgba(45,27,16,.06)", opacity: locked ? 0.55 : 1,
            }}>
              {/* icon circle */}
              <div style={{
                width:42, height:42, borderRadius:10, background:s.bg,
                display:"flex", alignItems:"center", justifyContent:"center",
                fontSize:18, color:s.color, flexShrink:0,
              }}>
                {s.icon}
              </div>
              {/* info */}
              <div style={{ flex:1 }}>
                <div style={{ fontSize:14, fontWeight:700, color: locked ? "#8b7355" : "#2d1b10", marginBottom:6 }}>
                  {t.title}
                  {locked && <span style={{ fontSize:11, fontWeight:500, color:"#8b7355", marginLeft:8 }}>(complete previous module first)</span>}
                </div>
                <div style={{ height:6, background:"#d4c5ad", borderRadius:3, overflow:"hidden" }}>
                  <div style={{
                    height:"100%", width: locked ? "0%" : pct+"%",
                    background: t.status === "done" ? "linear-gradient(90deg,#2e7d32,#66bb6a)"
                              : t.status === "in-progress" ? "linear-gradient(90deg,#f57c00,#ffb74d)"
                              : "#d4c5ad",
                    borderRadius:3, transition:"width .4s",
                  }} />
                </div>
              </div>
              {/* right: count + badge */}
              <div style={{ textAlign:"right", flexShrink:0 }}>
                <div style={{ fontSize:13, fontWeight:600, color:"#2d1b10" }}>{t.completed} / {t.totalLessons}</div>
                <div style={{ fontSize:11, color:s.color, fontWeight:600, marginTop:2 }}>
                  {t.status === "done" ? "Completed" : t.status === "in-progress" ? "In Progress" : "Locked"}
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGE: SUPER ADMIN â€“ LOAN SANCTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SuperAdminPage() {
  const [loans, setLoans]     = useState(PENDING_LOANS_INIT);
  const [modal, setModal]     = useState(null);   // the loan object being sanctioned
  const [inputAmt, setInputAmt] = useState("");
  const [toast, setToast]     = useState(null);

  function openModal(loan) { setModal(loan); setInputAmt(String(loan.requestedAmt)); }
  function closeModal()     { setModal(null); setInputAmt(""); }

  function approveLoan() {
    const amt = Number(inputAmt);
    if (!modal || !amt || amt <= 0) return;
    setLoans(prev => prev.map(l =>
      l.id === modal.id
        ? { ...l, status:"approved", sanctionedAmt:amt, approvedOn: new Date().toLocaleDateString("en-IN") }
        : l
    ));
    setToast(`Loan ${modal.id} sanctioned â€” â‚¹${amt.toLocaleString("en-IN")}`);
    setTimeout(() => setToast(null), 2200);
    closeModal();
  }

  const awaitCount  = loans.filter(l => l.status === "awaiting_admin").length;
  const approvedCnt = loans.filter(l => l.status === "approved").length;
  const bankPending = loans.filter(l => l.status === "bank_pending").length;

  return (
    <div>
      <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:4 }}>
        <h1 style={{ fontSize:24, fontWeight:700, color:"#2d1b10" }}>Super Admin â€“ Loan Sanctions</h1>
        <Badge type="info">Super Admin</Badge>
      </div>
      <p style={{ color:"#5d4e37", marginBottom:20 }}>Approve and set final loan amounts after bank verification passes.</p>

      {/* summary */}
      <div style={{ display:"grid", gridTemplateColumns:"repeat(4,1fr)", gap:16, marginBottom:24 }}>
        <StatCard icon="ðŸ“‹" value={loans.length}   label="Total Applications" />
        <StatCard icon="â³" value={awaitCount}     label="Awaiting Approval"  gradientColor="#f57c00" />
        <StatCard icon="âœ“"  value={approvedCnt}    label="Approved"           gradientColor="#2e7d32" />
        <StatCard icon="ðŸ¦" value={bankPending}    label="Bank Pending"       gradientColor="#8b7355" />
      </div>

      {/* table */}
      <div style={{ overflowX:"auto", background:"#fff", borderRadius:12, boxShadow:"0 2px 8px rgba(45,27,16,.08)", border:"1px solid #d4c5ad" }}>
        <table style={{ width:"100%", borderCollapse:"collapse" }}>
          <thead>
            <tr style={{ background:"linear-gradient(135deg,#d84315,#ff7043)" }}>
              {["Loan ID","Member","Requested","Bank Status","Status","Action"].map(h => (
                <th key={h} style={{ padding:"10px 16px", textAlign:"left", color:"#fff", fontSize:11, fontWeight:600, textTransform:"uppercase", letterSpacing:0.5, whiteSpace:"nowrap" }}>{h}</th>
              ))}
            </tr>
          </thead>
          <tbody>
            {loans.map(loan => {
              const canApprove = loan.status === "awaiting_admin";
              const isApproved = loan.status === "approved";
              return (
                <tr key={loan.id} style={{ borderBottom:"1px solid #d4c5ad", background: isApproved ? "rgba(46,125,50,.04)" : "transparent" }}>
                  {/* Loan ID */}
                  <td style={{ padding:"12px 16px" }}>
                    <div style={{ fontSize:13, fontWeight:700, color:"#d84315", fontFamily:"monospace" }}>{loan.id}</div>
                    <div style={{ fontSize:11, color:"#8b7355" }}>{loan.submittedOn}</div>
                  </td>
                  {/* Member */}
                  <td style={{ padding:"12px 16px" }}>
                    <div style={{ display:"flex", alignItems:"center", gap:10 }}>
                      <div style={{
                        width:34, height:34, borderRadius:"50%", flexShrink:0,
                        background:"linear-gradient(135deg,#d84315,#ffa726)",
                        display:"flex", alignItems:"center", justifyContent:"center",
                        color:"#fff", fontWeight:700, fontSize:14,
                      }}>{loan.member[0]}</div>
                      <div>
                        <div style={{ fontSize:13, fontWeight:600, color:"#2d1b10" }}>{loan.member}</div>
                        <div style={{ fontSize:11, color:"#8b7355" }}>{loan.purpose}</div>
                      </div>
                    </div>
                  </td>
                  {/* Requested */}
                  <td style={{ padding:"12px 16px" }}>
                    <div style={{ fontSize:15, fontWeight:700, color:"#2d1b10" }}>{fmt(loan.requestedAmt)}</div>
                    {isApproved && (
                      <div style={{ fontSize:11, color:"#2e7d32", fontWeight:600, marginTop:2 }}>
                        Sanctioned: {fmt(loan.sanctionedAmt)}
                      </div>
                    )}
                  </td>
                  {/* Bank Status */}
                  <td style={{ padding:"12px 16px" }}>
                    <div style={{ display:"flex", alignItems:"center", gap:6 }}>
                      <span style={{
                        width:8, height:8, borderRadius:"50%",
                        background: loan.bankStatus === "verified" ? "#2e7d32" : "#f57c00",
                        display:"inline-block",
                      }} />
                      <span style={{ fontSize:12, fontWeight:600, color: loan.bankStatus === "verified" ? "#2e7d32" : "#f57c00" }}>
                        {loan.bankStatus === "verified" ? "Verified" : "Pending"}
                      </span>
                    </div>
                    {loan.bankRef !== "â€”" && (
                      <div style={{ fontSize:10, color:"#8b7355", fontFamily:"monospace", marginTop:3 }}>{loan.bankRef}</div>
                    )}
                  </td>
                  {/* Status */}
                  <td style={{ padding:"12px 16px" }}>
                    <Badge type={isApproved ? "success" : canApprove ? "warning" : "secondary"}>
                      {isApproved ? "Approved" : canApprove ? "Awaiting Admin" : "Bank Pending"}
                    </Badge>
                    {isApproved && loan.approvedOn && (
                      <div style={{ fontSize:10, color:"#8b7355", marginTop:3 }}>Approved {loan.approvedOn}</div>
                    )}
                  </td>
                  {/* Action */}
                  <td style={{ padding:"12px 16px" }}>
                    {canApprove ? (
                      <button
                        onClick={() => openModal(loan)}
                        style={{
                          padding:"7px 16px", border:"2px solid #d84315", borderRadius:8,
                          background:"transparent", color:"#d84315", fontSize:12, fontWeight:600,
                          cursor:"pointer", fontFamily:"inherit", transition:"all .2s",
                        }}
                        onMouseEnter={e => { e.currentTarget.style.background="#d84315"; e.currentTarget.style.color="#fff"; }}
                        onMouseLeave={e => { e.currentTarget.style.background="transparent"; e.currentTarget.style.color="#d84315"; }}
                      >
                        Sanction Loan
                      </button>
                    ) : (
                      <span style={{ fontSize:12, color:"#8b7355", fontWeight:600 }}>
                        {isApproved ? "âœ“ Done" : "â³ Waitingâ€¦"}
                      </span>
                    )}
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>

      {/* â”€â”€ SANCTION MODAL â”€â”€ */}
      {modal && (
        <div style={{
          position:"fixed", inset:0, background:"rgba(0,0,0,.45)", backdropFilter:"blur(3px)",
          display:"flex", alignItems:"center", justifyContent:"center", zIndex:50,
        }} onClick={closeModal}>
          <div style={{
            background:"#fff", borderRadius:16, padding:32, width:"100%", maxWidth:440,
            boxShadow:"0 12px 40px rgba(45,27,16,.2)", border:"1px solid #d4c5ad", position:"relative",
          }} onClick={e => e.stopPropagation()}>
            {/* close */}
            <button onClick={closeModal} style={{ position:"absolute", top:16, right:18, background:"none", border:"none", fontSize:22, color:"#8b7355", cursor:"pointer" }}>Ã—</button>

            <h3 style={{ fontSize:18, fontWeight:700, color:"#2d1b10", marginBottom:4 }}>Sanction Loan Amount</h3>
            <p style={{ fontSize:13, color:"#5d4e37", marginBottom:22 }}>
              Set the approved amount for <strong>{modal.member}</strong>. You can adjust or keep the requested amount.
            </p>

            {/* bank ref pill */}
            <div style={{ marginBottom:18 }}>
              <label style={{ fontSize:11, fontWeight:600, color:"#8b7355", textTransform:"uppercase", letterSpacing:0.5, display:"block", marginBottom:6 }}>Bank Verification Ref</label>
              <span style={{ display:"inline-block", fontSize:12, fontWeight:600, color:"#2e7d32", background:"rgba(46,125,50,.1)", padding:"5px 12px", borderRadius:6 }}>
                âœ“ {modal.bankRef}
              </span>
            </div>

            {/* requested */}
            <div style={{ marginBottom:18 }}>
              <label style={{ fontSize:11, fontWeight:600, color:"#8b7355", textTransform:"uppercase", letterSpacing:0.5, display:"block", marginBottom:4 }}>Requested Amount</label>
              <span style={{ fontSize:14, color:"#5d4e37" }}>{fmt(modal.requestedAmt)} â€” {modal.purpose}</span>
            </div>

            {/* amount input */}
            <div style={{ marginBottom:24 }}>
              <label style={{ fontSize:11, fontWeight:600, color:"#8b7355", textTransform:"uppercase", letterSpacing:0.5, display:"block", marginBottom:6 }}>Loan Amount to Sanction (â‚¹)</label>
              <input
                type="number"
                value={inputAmt}
                onChange={e => setInputAmt(e.target.value)}
                placeholder="Enter amount"
                style={{
                  width:"100%", padding:"11px 14px", border:"2px solid #d4c5ad", borderRadius:8,
                  fontSize:18, fontWeight:700, color:"#2d1b10", fontFamily:"inherit", outline:"none", boxSizing:"border-box",
                }}
                onFocus={e => e.target.style.borderColor="#d84315"}
                onBlur={e => e.target.style.borderColor="#d4c5ad"}
              />
              <p style={{ fontSize:11, color:"#8b7355", marginTop:5 }}>Enter the final approved amount. Adjust if needed or keep as requested.</p>
            </div>

            {/* action buttons */}
            <div style={{ display:"flex", gap:10 }}>
              <button onClick={closeModal} style={{
                flex:1, padding:"10px", border:"2px solid #d4c5ad", borderRadius:8,
                background:"#fff", color:"#5d4e37", fontSize:13, fontWeight:600,
                cursor:"pointer", fontFamily:"inherit",
              }}>Cancel</button>
              <button
                onClick={approveLoan}
                disabled={!inputAmt || isNaN(inputAmt) || Number(inputAmt) <= 0}
                style={{
                  flex:1, padding:"10px", border:"none", borderRadius:8,
                  background: (!inputAmt || isNaN(inputAmt) || Number(inputAmt) <= 0) ? "#ccc" : "linear-gradient(135deg,#d84315,#ff7043)",
                  color:"#fff", fontSize:13, fontWeight:600, cursor: (!inputAmt || isNaN(inputAmt) || Number(inputAmt) <= 0) ? "not-allowed" : "pointer",
                  fontFamily:"inherit", boxShadow: (!inputAmt || isNaN(inputAmt) || Number(inputAmt) <= 0) ? "none" : "0 4px 12px rgba(216,67,21,.3)",
                }}
              >
                Approve & Sanction
              </button>
            </div>
          </div>
        </div>
      )}

      {/* toast */}
      {toast && (
        <div style={{
          position:"fixed", bottom:30, left:"50%", transform:"translateX(-50%)",
          background:"linear-gradient(135deg,#2e7d32,#66bb6a)", color:"#fff",
          padding:"10px 24px", borderRadius:8, fontSize:13, fontWeight:600,
          boxShadow:"0 4px 16px rgba(46,125,50,.35)", zIndex:100,
        }}>
          âœ“ {toast}
        </div>
      )}
    </div>
  );
}

const SHGChatbot = ({ csvData }) => {
  const [input, setInput] = useState("");
  const [chatLog, setChatLog] = useState([{ role: "bot", text: "Namaste! I'm your SHG data assistant. How can I help you today?" }]);
  const [loading, setLoading] = useState(false);
  const [isOpen, setIsOpen] = useState(false);

  const askGemini = async () => {
  if (!input.trim()) return;
  const userMsg = input;
  setInput("");
  setLoading(true);
  setChatLog(prev => [...prev, { role: "user", text: userMsg }]);
  
  const prompt = `You are an AI assistant for a Women's Self-Help Group (SHG) platform. 
  Use the following SHG data to answer questions: ${csvData}
  User question: ${userMsg}`;

  try {
    // 1. Ensure there is NO bracket after the key
    // 2. Use backticks (`) for the URL
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=AIzaSyAXgAtuw6gZolNl37jbOPgEVOoBf96e2uc`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{
          parts: [{ text: prompt }]
        }]
      })
    });

    const data = await response.json();

    if (data.error) {
      setChatLog(prev => [...prev, { role: "bot", text: `Error: ${data.error.message}` }]);
    } else {
      const botReply = data.candidates[0].content.parts[0].text;
      setChatLog(prev => [...prev, { role: "bot", text: botReply }]);
    }
  } catch (e) {
    setChatLog(prev => [...prev, { role: "bot", text: "Connection failed." }]);
  } finally {
    setLoading(false);
  }
};
  if (!isOpen) return (
    <button onClick={() => setIsOpen(true)} style={{ position: 'fixed', bottom: '20px', right: '20px', padding: '15px 25px', borderRadius: '50px', background: '#D84315', color: 'white', border: 'none', cursor: 'pointer', boxShadow: '0 4px 15px rgba(0,0,0,0.2)', fontWeight: 'bold', zIndex: 1000 }}>
      ðŸ’¬ Ask Data Assistant
    </button>
  );

  return (
    <div style={{ position: 'fixed', bottom: '20px', right: '20px', width: '350px', height: '450px', background: 'white', borderRadius: '15px', boxShadow: '0 10px 25px rgba(0,0,0,0.2)', display: 'flex', flexDirection: 'column', overflow: 'hidden', zIndex: 1000, border: '1px solid #eee' }}>
      <div style={{ background: '#D84315', color: 'white', padding: '15px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
        <span style={{ fontWeight: 'bold' }}>SHG AI Assistant</span>
        <button onClick={() => setIsOpen(false)} style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer', fontSize: '18px' }}>âœ•</button>
      </div>
      <div style={{ flex: 1, overflowY: 'auto', padding: '15px', display: 'flex', flexDirection: 'column', gap: '10px' }}>
        {chatLog.map((msg, i) => (
          <div key={i} style={{ alignSelf: msg.role === 'user' ? 'flex-end' : 'flex-start', background: msg.role === 'user' ? '#FFE0B2' : '#F5F5F5', color: '#333', padding: '10px', borderRadius: '12px', maxWidth: '85%', fontSize: '0.9rem', lineHeight: '1.4' }}>
            {msg.text}
          </div>
        ))}
      </div>
      <div style={{ padding: '10px', borderTop: '1px solid #eee', display: 'flex', gap: '5px' }}>
        <input value={input} onChange={e => setInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && askGemini()} placeholder="Who has the highest savings?" style={{ flex: 1, padding: '10px', border: '1px solid #ddd', borderRadius: '8px', outline: 'none' }} />
        <button onClick={askGemini} disabled={loading} style={{ background: '#D84315', color: 'white', border: 'none', padding: '10px 15px', borderRadius: '8px', cursor: 'pointer' }}>
          {loading ? '...' : 'Send'}
        </button>
      </div>
    </div>
  );
};


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ROOT APP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export default function App() {
  const [flow, setFlow]               = useState("landing");   // landing â†’ login â†’ select â†’ app
  const [role, setRole]               = useState(null);        // "leader" | "member"
  const [selectedSHG, setSelectedSHG] = useState(null);
  const [memberName, setMemberName]   = useState(null);        // only set when role==="member"
  const [page, setPage]               = useState("dashboard");

  // called by LoginPage with chosen role
  const handleLogin = useCallback((chosenRole) => {
    setRole(chosenRole);
    if (chosenRole === "superadmin") {
      setFlow("app");
      setPage("superadmin");
    } else {
      setFlow("select");
    }
  }, []);

  // called by SHGSelectPage with (shg, name|null)
  const handleSelect = useCallback((shg, name) => {
    setSelectedSHG(shg);
    setMemberName(name);          // null for leader, member's name for member
    setFlow("app");
    setPage("dashboard");
  }, []);

  // Switch SHG â†’ back to select screen (keeps role alive)
  const handleSwitchSHG = useCallback(() => {
    setSelectedSHG(null);
    setMemberName(null);
    setFlow("select");
    setPage("dashboard");
  }, []);

  // Logout â†’ full reset
  const handleLogout = useCallback(() => {
    setSelectedSHG(null);
    setMemberName(null);
    setRole(null);
    setFlow("landing");
  }, []);

  // â”€â”€ PRE-APP SCREENS â”€â”€
  if (flow === "landing") return <LandingPage onGetStarted={() => setFlow("login")} />;
  if (flow === "login")   return <LoginPage  onLogin={handleLogin}  onBack={() => setFlow("landing")} />;
  if (flow === "select")  return <SHGSelectPage role={role} onSelect={handleSelect} onBack={() => setFlow("login")} />;

  // â”€â”€ MAIN APP â”€â”€
  // Member-role guard: if somehow a member tries to hit a leader-only page, bounce to dashboard
  const LEADER_ONLY = new Set(["members", "reports", "insights", "ngolocator"]);
  const safePage = (role === "member" && LEADER_ONLY.has(page)) ? "dashboard"
                 : (role === "superadmin" && page !== "superadmin") ? "superadmin"
                 : page;

  const pageContent = (() => {
    switch (safePage) {
      case "dashboard":     return <DashboardPage     selectedSHG={selectedSHG} role={role} memberName={memberName} setPage={setPage} />;
      case "members":       return <MembersPage       selectedSHG={selectedSHG} />;
      case "savings":       return <SavingsPage       selectedSHG={selectedSHG} role={role} memberName={memberName} />;
      case "loans":         return <LoansPage         selectedSHG={selectedSHG} role={role} memberName={memberName} />;
      case "meetings":      return <MeetingsPage />;
      case "notifications": return <NotificationsPage selectedSHG={selectedSHG} role={role} memberName={memberName} />;
      case "training":      return <TrainingPage      selectedSHG={selectedSHG} role={role} memberName={memberName} />;
      case "ngolocator":    return <NGOLocatorPage />;
      case "reports":       return <ReportsPage       selectedSHG={selectedSHG} />;
      case "insights":      return <InsightsPage      selectedSHG={selectedSHG} />;
      case "superadmin":    return <SuperAdminPage />;
      default:              return <DashboardPage     selectedSHG={selectedSHG} role={role} memberName={memberName} setPage={setPage} />;
    }
  })();

  return (
    <div style={{ display: "flex", minHeight: "100vh", fontFamily: "'Poppins', sans-serif", background: "#fdfbf7" }}>
      <Sidebar
        selectedSHG={selectedSHG}
        role={role}
        memberName={memberName}
        page={safePage}
        setPage={setPage}
        onSwitchSHG={handleSwitchSHG}
        onLogout={handleLogout}
      />
      <main style={{ flex: 1, padding: 28, minWidth: 0, overflowX: "auto" }}>{pageContent}</main>
      <SHGChatbot csvData={RAW_CSV} />
    </div>
  );
}
